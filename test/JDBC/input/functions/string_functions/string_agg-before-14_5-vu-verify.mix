-- tsql
-- input type char
SELECT STRING_AGG(col_char, NULL) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

SELECT STRING_AGG(col_char, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep CHAR(1) = '-'
SELECT STRING_AGG(col_char, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep VARCHAR(10) = '-'
SELECT STRING_AGG(col_char, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep NCHAR(1) = '-'
SELECT STRING_AGG(col_char, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep NVARCHAR(10) = '-'
SELECT STRING_AGG(col_char, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep CHAR(5) = N'ðŸ«¥'
SELECT STRING_AGG(col_char, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep VARCHAR(10) = N'ðŸ«¥'
SELECT STRING_AGG(col_char, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep NCHAR(5) = N'ðŸ«¥'
SELECT STRING_AGG(col_char, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep NVARCHAR(10) = N'ðŸ«¥'
SELECT STRING_AGG(col_char, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep CHAR(5) = N'å°¸'
SELECT STRING_AGG(col_char, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep VARCHAR(10) = N'å°¸'
SELECT STRING_AGG(col_char, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep NCHAR(5) = N'å°¸'
SELECT STRING_AGG(col_char, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep NVARCHAR(10) = N'å°¸'
SELECT STRING_AGG(col_char, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

-- input type varchar
SELECT STRING_AGG(col_varchar, NULL) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

SELECT STRING_AGG(col_varchar, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep CHAR(1) = '-'
SELECT STRING_AGG(col_varchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep VARCHAR(10) = '-'
SELECT STRING_AGG(col_varchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep NCHAR(1) = '-'
SELECT STRING_AGG(col_varchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep NVARCHAR(10) = '-'
SELECT STRING_AGG(col_varchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep CHAR(5) = N'ðŸ«¥'
SELECT STRING_AGG(col_varchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep VARCHAR(10) = N'ðŸ«¥'
SELECT STRING_AGG(col_varchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep NCHAR(5) = N'ðŸ«¥'
SELECT STRING_AGG(col_varchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep NVARCHAR(10) = N'ðŸ«¥'
SELECT STRING_AGG(col_varchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep CHAR(5) = N'å°¸'
SELECT STRING_AGG(col_varchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep VARCHAR(10) = N'å°¸'
SELECT STRING_AGG(col_varchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep NCHAR(5) = N'å°¸'
SELECT STRING_AGG(col_varchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep NVARCHAR(10) = N'å°¸'
SELECT STRING_AGG(col_varchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

-- with table column of type varchar with collation chinese_prc_ci_as
SELECT STRING_AGG(col1_cias, '-') FROM babel_5156_string_agg_t2 GROUP BY group_id ORDER BY group_id
GO

-- with table column of type varchar with collation chinese_prc_cs_as
SELECT STRING_AGG(col1_csas, '-') FROM babel_5156_string_agg_t2 GROUP BY group_id ORDER BY group_id
GO

-- with table column of type varchar with collation chinese_prc_ci_ai
SELECT STRING_AGG(col1_ciai, '-') FROM babel_5156_string_agg_t2 GROUP BY group_id ORDER BY group_id
GO

-- with table column of type varchar with collation arabic_prc_ci_as
SELECT STRING_AGG(col2_cias, '-') FROM babel_5156_string_agg_t2 GROUP BY group_id ORDER BY group_id
GO

-- with table column of type varchar with collation arabic_prc_cs_as
SELECT STRING_AGG(col2_csas, '-') FROM babel_5156_string_agg_t2 GROUP BY group_id ORDER BY group_id
GO

-- with table column of type varchar with collation arabic_prc_ci_ai
SELECT STRING_AGG(col2_ciai, '-') FROM babel_5156_string_agg_t2 GROUP BY group_id ORDER BY group_id
GO

-- input type nchar
SELECT STRING_AGG(col_nchar, NULL) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

SELECT STRING_AGG(col_nchar, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep CHAR(1) = '-'
SELECT STRING_AGG(col_nchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep VARCHAR(10) = '-'
SELECT STRING_AGG(col_nchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep NCHAR(1) = '-'
SELECT STRING_AGG(col_nchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep NVARCHAR(10) = '-'
SELECT STRING_AGG(col_nchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep CHAR(5) = N'ðŸ«¥'
SELECT STRING_AGG(col_nchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep VARCHAR(10) = N'ðŸ«¥'
SELECT STRING_AGG(col_nchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep NCHAR(5) = N'ðŸ«¥'
SELECT STRING_AGG(col_nchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep NVARCHAR(10) = N'ðŸ«¥'
SELECT STRING_AGG(col_nchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep CHAR(5) = N'å°¸'
SELECT STRING_AGG(col_nchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep VARCHAR(10) = N'å°¸'
SELECT STRING_AGG(col_nchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep NCHAR(5) = N'å°¸'
SELECT STRING_AGG(col_nchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep NVARCHAR(10) = N'å°¸'
SELECT STRING_AGG(col_nchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

-- input type nvarchar
SELECT STRING_AGG(col_nvarchar, NULL) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

SELECT STRING_AGG(col_nvarchar, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep CHAR(1) = '-'
SELECT STRING_AGG(col_nvarchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep VARCHAR(10) = '-'
SELECT STRING_AGG(col_nvarchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep NCHAR(1) = '-'
SELECT STRING_AGG(col_nvarchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep NVARCHAR(10) = '-'
SELECT STRING_AGG(col_nvarchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep CHAR(5) = N'ðŸ«¥'
SELECT STRING_AGG(col_nvarchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep VARCHAR(10) = N'ðŸ«¥'
SELECT STRING_AGG(col_nvarchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep NCHAR(5) = N'ðŸ«¥'
SELECT STRING_AGG(col_nvarchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep NVARCHAR(10) = N'ðŸ«¥'
SELECT STRING_AGG(col_nvarchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep CHAR(5) = N'å°¸'
SELECT STRING_AGG(col_nvarchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep VARCHAR(10) = N'å°¸'
SELECT STRING_AGG(col_nvarchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep NCHAR(5) = N'å°¸'
SELECT STRING_AGG(col_nvarchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep NVARCHAR(10) = N'å°¸'
SELECT STRING_AGG(col_nvarchar, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

-- dependent objects
SELECT * FROM babel_5156_string_agg_dep_view1
GO

EXEC babel_5156_string_agg_dep_proc1
GO

SELECT babel_5156_string_agg_dep_func1()
GO

SELECT babel_5156_string_agg_itvf_func1()
GO

SELECT * FROM babel_5156_string_agg_dep_view2
GO

EXEC babel_5156_string_agg_dep_proc2
GO

SELECT babel_5156_string_agg_dep_func2()
GO

SELECT babel_5156_string_agg_itvf_func2()
GO

-- computed columns (Not allowed, should throw error)
CREATE TABLE babel_5156_string_agg_compcol(col_varchar varchar(100), comp_col as string_agg(col_varchar, ','))
GO

-- check constraints (Not allowed, should throw error)
CREATE TABLE babel_5156_string_agg_constraint(col_varchar varchar(100), constraint chkCombinedLen check(len(string_agg(col_varchar, ',')) < 10))
GO

-- input type UDT
SELECT STRING_AGG(col_varUDT, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

SELECT STRING_AGG(col_imageUDT, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

-- other different datatypes
SELECT STRING_AGG(col_int, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep int = 0
SELECT STRING_AGG(col_int, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO


SELECT STRING_AGG(col_bigint, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep bigint = 0
SELECT STRING_AGG(col_bigint, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO


SELECT STRING_AGG(col_smallint, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep smallint = 0
SELECT STRING_AGG(col_smallint, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO


SELECT STRING_AGG(col_tinyint, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep tinyint = 0
SELECT STRING_AGG(col_tinyint, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO


SELECT STRING_AGG(col_numeric, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep numeric = 0.0
SELECT STRING_AGG(col_numeric, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO


SELECT STRING_AGG(col_float, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep float = 0.0
SELECT STRING_AGG(col_float, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO


SELECT STRING_AGG(col_real, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep real = 0.0
SELECT STRING_AGG(col_real, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO


SELECT STRING_AGG(col_bit, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep bit = 0
SELECT STRING_AGG(col_bit, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO


SELECT STRING_AGG(col_decimal, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep decimal = 0
SELECT STRING_AGG(col_decimal, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO


SELECT STRING_AGG(col_money, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep money = 0
SELECT STRING_AGG(col_money, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO


SELECT STRING_AGG(col_smallmoney, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep smallmoney = 0
SELECT STRING_AGG(col_smallmoney, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO


SELECT STRING_AGG(col_datetime, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

SELECT STRING_AGG(col_datetime2, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO


SELECT STRING_AGG(col_binary, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep binary(1) = 0x2D
SELECT STRING_AGG(col_binary, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO


SELECT STRING_AGG(col_varbinary, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep varbinary(10) = 0x2D
SELECT STRING_AGG(col_varbinary, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO


SELECT STRING_AGG(col_date, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

SELECT STRING_AGG(col_time, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

SELECT STRING_AGG(col_datetimeoffset, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

SELECT STRING_AGG(col_smalldatetime, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO


SELECT STRING_AGG(col_image, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep image = CAST('-' as image)
SELECT STRING_AGG(col_image, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

-- input datatype text
SELECT STRING_AGG(col_text, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

-- input datatype ntext
SELECT STRING_AGG(col_ntext, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO


SELECT STRING_AGG(col_sql_variant, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep sql_variant = CAST('-' as sql_variant)
SELECT STRING_AGG(col_sql_variant, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO


SELECT STRING_AGG(col_xml, '-') FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

DECLARE @sep xml = CAST('-' as xml)
SELECT STRING_AGG(col_xml, @sep) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO


-- Testing implicit cast from bit to varchar
DECLARE @a bit = 1;
EXEC babel_5156_cast_bit_to_varchar_proc @a
GO

DECLARE @a bit = 1;
SELECT babel_5156_cast_bit_to_varchar_func(@a)
GO

DECLARE @a bit = 1;
EXEC babel_5156_cast_bit_to_nvarchar_proc @a
GO

DECLARE @a bit = 1;
SELECT babel_5156_cast_bit_to_nvarchar_func(@a)
GO

-- Tests for STRING_AGG function with WITHIN GROUP 
-- This is not supported, so an error is thrown
SELECT STRING_AGG(col_char, '-') WITHIN GROUP (order by id) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

SELECT STRING_AGG(col_nchar, '-') WITHIN GROUP (order by id) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

SELECT STRING_AGG(col_varchar, '-') WITHIN GROUP (order by id) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO

SELECT STRING_AGG(col_nvarchar, '-') WITHIN GROUP (order by id) FROM babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id
GO


-- psql
-- all of the following queries should use PG_CATALOG.string_agg function
SELECT STRING_AGG(col_text, '-') FROM master_dbo.babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id;
GO

SELECT STRING_AGG(col_ntext, '-') FROM master_dbo.babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id;
GO

SELECT STRING_AGG(col_char, '-') FROM master_dbo.babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id;
GO

SELECT STRING_AGG(col_nchar, '-') FROM master_dbo.babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id;
GO

SELECT STRING_AGG(col_varchar, '-') FROM master_dbo.babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id;
GO

SELECT STRING_AGG(col_varchar, cast('-' as sys.varchar)) FROM master_dbo.babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id;
GO

SELECT STRING_AGG(col_nvarchar, '-') FROM master_dbo.babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id;
GO

SELECT STRING_AGG(col_nvarchar, cast('-' as sys.varchar)) FROM master_dbo.babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id;
GO

SELECT STRING_AGG(col_binary, '-') FROM master_dbo.babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id;
GO

SELECT STRING_AGG(col_varbinary, '-') FROM master_dbo.babel_5156_string_agg_t1 GROUP BY group_id ORDER BY group_id;
GO


