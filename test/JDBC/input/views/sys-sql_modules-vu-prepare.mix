-- Setup
CREATE DATABASE sys_sql_modules_vu_prepare_db
GO

CREATE VIEW sys_sql_modules_vu_prepare_v1 AS -- This view should not be seen as we will be using a different database for the test
SELECT 1
GO

USE sys_sql_modules_vu_prepare_db
GO

CREATE TABLE sys_sql_modules_vu_prepare_t1(a int)
GO

CREATE TABLE sys_sql_modules_vu_prepare_t2(a int)
GO

CREATE TRIGGER sys_sql_modules_vu_prepare_tr1 ON sys_sql_modules_vu_prepare_t2 INSTEAD OF INSERT
AS
BEGIN
SELECT * FROM sys_sql_modules_vu_prepare_t1;
END
GO

CREATE VIEW sys_sql_modules_vu_prepare_v2 AS
SELECT 1
GO

CREATE FUNCTION sys_sql_modules_vu_prepare_f1() 
RETURNS INT
AS 
BEGIN
    RETURN 1;
END
GO

CREATE PROC sys_sql_modules_vu_prepare_p1 AS
SELECT 1
GO

-- Test permission for all_sql_modules (query should not have any results)
CREATE LOGIN sys_sql_modules_vu_prepare_user WITH PASSWORD='test'
GO

CREATE USER sys_sql_modules_vu_prepare_user FOR LOGIN sys_sql_modules_vu_prepare_user
GO

USE master
GO
