USE sys_views_vu_prepare_db1
GO

SELECT COUNT(*) FROM sys.views WHERE name = 'sys_views_vu_prepare_t1';
GO

-- Should not include sysdatabases
SELECT COUNT(*) FROM sys.views WHERE type = 'V' and name = 'sysdatabases'
GO

SELECT COUNT(*) FROM sys.objects WHERE type='V' and name = 'sys_views_vu_prepare_t1';
GO

SELECT COUNT(*) FROM sys.all_objects WHERE type='V' and name = 'sys_views_vu_prepare_t1';
GO

USE master;
GO

#view sys_views_vu_prepare_t1 should not be visible in master database.
SELECT COUNT(*) FROM sys.views WHERE name = 'sys_views_vu_prepare_t1';
GO

SELECT COUNT(*) FROM sys.objects WHERE type='V' and name = 'sys_views_vu_prepare_t1';
GO

SELECT COUNT(*) FROM sys.all_objects WHERE type='V' and name = 'sys_views_vu_prepare_t1';
GO

SELECT COUNT(*) FROM sys.views WHERE name = 'sys_views_vu_prepare_t2';
GO

SELECT COUNT(*) FROM sys.objects WHERE type='V' and name = 'sys_views_vu_prepare_t2';
GO

SELECT COUNT(*) FROM sys.all_objects WHERE type='V' and name = 'sys_views_vu_prepare_t2';
GO

USE sys_views_vu_prepare_db1
GO

#view sys_views_vu_prepare_t2 should not be visible in sys_views_vu_prepare_db1 database.
SELECT COUNT(*) FROM sys.views WHERE name = 'sys_views_vu_prepare_t2';
GO

SELECT COUNT(*) FROM sys.objects WHERE type='V' and name = 'sys_views_vu_prepare_t2';
GO

SELECT COUNT(*) FROM sys.all_objects WHERE type='V' and name = 'sys_views_vu_prepare_t2';
GO

-- reset the login password
ALTER LOGIN sys_views_login_l1 WITH PASSWORD = '12345678'
GO

-- tsql user=sys_views_login_l1 password=12345678
USE sys_views_vu_prepare_db1;
GO

#view sys_views_vu_prepare_s1.sys_views_vu_prepare_v1 should not be visible in db1 database to sys_views_login_l1.
select count(*) from sys.views where name = 'sys_views_vu_prepare_v1';
GO

SELECT COUNT(*) FROM sys.all_objects WHERE type='V' and name = 'sys_views_vu_prepare_v1';
GO

-- tsql
use sys_views_vu_prepare_db1;
GO

GRANT select on schema::sys_views_vu_prepare_s1 to sys_views_user_u1;
GO

-- tsql user=sys_views_login_l1 password=12345678
USE sys_views_vu_prepare_db1;
GO

# view sys_views_vu_prepare_s1.sys_views_vu_prepare_v1 should be visible in db1 database to sys_views_login_l1 now.
select count(*) from sys.views where name = 'sys_views_vu_prepare_v1';
GO

SELECT COUNT(*) FROM sys.all_objects WHERE type='V' and name = 'sys_views_vu_prepare_v1';
GO
