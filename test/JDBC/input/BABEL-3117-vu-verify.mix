-- psql
ALTER SYSTEM SET babelfishpg_tsql.migration_mode = 'multi-db';
SELECT pg_reload_conf();
GO

-- tsql
USE BABEL_3117_prepare_db1
GO

SELECT count(*) FROM BABEL_3117_prepare_db1_employeeData;
GO

DROP TRIGGER BABEL_3117_prepare_trigger1
GO

USE BABEL_3117_prepare_db2
GO
SELECT count(*) FROM BABEL_3117_prepare_db2_employeeData;
GO

-- Test with database has the same schema name, same table name and same trigger name
USE BABEL_3117_prepare_db3
GO

-- Should return 0 since trigger exits
SELECT count(*) FROM BABEL_3117_schema.BABEL_3117_t1;
GO


DROP TRIGGER BABEL_3117_schema.BABEL_3117_prepare_trigger2
GO

-- Should return error since trigger is dropped 
DROP TRIGGER BABEL_3117_schema.BABEL_3117_prepare_trigger2
GO

USE BABEL_3117_prepare_db4

-- Should return 0 since trigger exits
SELECT count(*) FROM BABEL_3117_schema.BABEL_3117_t1;
GO

DROP TRIGGER BABEL_3117_schema.BABEL_3117_prepare_trigger2
GO

-- Should return error since trigger is dropped 
DROP TRIGGER BABEL_3117_schema.BABEL_3117_prepare_trigger2
GO

DROP TABLE BABEL_3117_schema.BABEL_3117_t1
DROP SCHEMA BABEL_3117_schema
GO

USE BABEL_3117_prepare_db3
GO

DROP TABLE BABEL_3117_schema.BABEL_3117_t1
DROP SCHEMA BABEL_3117_schema
GO

-- Test with database has different schema name, same table name and same trigger name
USE BABEL_3117_prepare_db5
GO

-- Should return 0 since trigger exits
SELECT count(*) FROM BABEL_3117_schemaA.BABEL_3117_t1;
GO


DROP TRIGGER BABEL_3117_schemaA.BABEL_3117_prepare_trigger3
GO

-- Should return error since trigger is dropped 
DROP TRIGGER BABEL_3117_schemaA.BABEL_3117_prepare_trigger3
GO

-- Should return error since don't have permission
DROP TRIGGER BABEL_3117_schemaB.BABEL_3117_prepare_trigger3
GO

USE BABEL_3117_prepare_db6

-- Should return 0 since trigger exits
SELECT count(*) FROM BABEL_3117_schemaB.BABEL_3117_t1;
GO

DROP TRIGGER BABEL_3117_schemaB.BABEL_3117_prepare_trigger3
GO

-- Should return error since trigger is dropped 
DROP TRIGGER BABEL_3117_schemaB.BABEL_3117_prepare_trigger3
GO

-- Should return error since don't have permission
DROP TRIGGER BABEL_3117_schemaA.BABEL_3117_prepare_trigger3
GO

DROP TABLE BABEL_3117_schemaB.BABEL_3117_t1
DROP SCHEMA BABEL_3117_schemaB
GO

USE BABEL_3117_prepare_db5
GO

DROP TABLE BABEL_3117_schemaA.BABEL_3117_t1
DROP SCHEMA BABEL_3117_schemaA
GO

USE master
GO

DROP DATABASE BABEL_3117_prepare_db1
DROP DATABASE BABEL_3117_prepare_db2
DROP DATABASE BABEL_3117_prepare_db3
DROP DATABASE BABEL_3117_prepare_db4
DROP DATABASE BABEL_3117_prepare_db5
DROP DATABASE BABEL_3117_prepare_db6
GO

-- psql
ALTER SYSTEM SET babelfishpg_tsql.migration_mode = 'single-db';
SELECT pg_reload_conf();
GO
