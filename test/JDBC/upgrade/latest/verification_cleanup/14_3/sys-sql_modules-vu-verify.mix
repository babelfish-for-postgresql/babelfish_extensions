USE sys_sql_modules_vu_prepare_db1
GO

-- Test for function
SELECT
    definition,
    uses_ansi_nulls,
    uses_quoted_identifier,
    is_schema_bound,
    uses_database_collation,
    is_recompiled,
    null_on_null_input,
    execute_as_principal_id,
    uses_native_compilation
FROM sys.sql_modules
WHERE object_id = OBJECT_ID('sys_sql_modules_vu_prepare_function')
GO

-- Test for views
SELECT
    definition,
    uses_ansi_nulls,
    uses_quoted_identifier,
    is_schema_bound,
    uses_database_collation,
    is_recompiled,
    null_on_null_input,
    execute_as_principal_id,
    uses_native_compilation
FROM sys.sql_modules
WHERE object_id = OBJECT_ID('sys_sql_modules_vu_prepare_view')
GO

-- Test for triggers
SELECT
    definition,
    uses_ansi_nulls,
    uses_quoted_identifier,
    is_schema_bound,
    uses_database_collation,
    is_recompiled,
    null_on_null_input,
    execute_as_principal_id,
    uses_native_compilation
FROM sys.sql_modules
WHERE object_id = (SELECT TOP(1) object_id FROM sys.all_objects WHERE name = 'sys_sql_modules_vu_prepare_tr1')
GO

-- Test for proc
SELECT
    definition,
    uses_ansi_nulls,
    uses_quoted_identifier,
    is_schema_bound,
    uses_database_collation,
    is_recompiled,
    null_on_null_input,
    execute_as_principal_id,
    uses_native_compilation
FROM sys.sql_modules
WHERE object_id = OBJECT_ID('sys_sql_modules_vu_prepare_proc')
GO

-- Test that sys.sql_modules is database-scoped
SELECT
    definition,
    uses_ansi_nulls,
    uses_quoted_identifier,
    is_schema_bound,
    uses_database_collation,
    is_recompiled,
    null_on_null_input,
    execute_as_principal_id,
    uses_native_compilation
FROM sys.sql_modules
WHERE object_id = OBJECT_ID('sys_sql_modules_vu_prepare_master_view')
GO

USE master
GO

-- tsql user=sys_sql_modules_vu_prepare_user password=test

USE sys_sql_modules_vu_prepare_db1
GO

SELECT
    definition,
    uses_ansi_nulls,
    uses_quoted_identifier,
    is_schema_bound,
    uses_database_collation,
    is_recompiled,
    null_on_null_input,
    execute_as_principal_id,
    uses_native_compilation
FROM sys.sql_modules
WHERE object_id = OBJECT_ID('sys_sql_modules_vu_prepare_proc')
GO
