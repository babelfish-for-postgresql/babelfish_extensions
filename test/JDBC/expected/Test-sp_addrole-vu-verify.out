-- tsql
CREATE ROLE sp_addrole_r1;
GO

--Throws an error if the argument is empty or contains backslash(\)
Exec sp_addrole '';
GO
~~ERROR (Code: 33557097)~~

~~ERROR (Message: Name cannot be NULL.)~~


Exec sp_addrole '\';
GO
~~ERROR (Code: 33557097)~~

~~ERROR (Message: '\' is not a valid name because it contains invalid characters.)~~


-- Throws an error when role exists
Exec sp_addrole 'sp_addrole_r1';
GO
~~ERROR (Code: 33557097)~~

~~ERROR (Message: User, group, or role 'sp_addrole_r1' already exists in the current database.)~~


-- Creates role even if it contains leading/trailing spaces, special characters(except \)
Exec sp_addrole '   @sp_addrole_r2   ';
GO

SELECT rolname, type, orig_username, database_name
FROM sys.babelfish_authid_user_ext
WHERE orig_username = '   @sp_addrole_r2   '
GO
~~START~~
varchar#!#char#!#nvarchar#!#nvarchar
master_   @sp_addrole_r2   #!#R#!#   @sp_addrole_r2   #!#master
~~END~~


-- sp_addrole is case insensitive, storing all role values in lower case in DB
EXEC sp_addrole 'SP_ADDROLE_R3';
GO

-- Throws an error when role exists
EXEC sp_addrole 'SP_ADDROLE_R3';
GO
~~ERROR (Code: 33557097)~~

~~ERROR (Message: User, group, or role 'SP_ADDROLE_R3' already exists in the current database.)~~


EXEC sp_addrole 'sp_addrole_r3';
GO
~~ERROR (Code: 33557097)~~

~~ERROR (Message: User, group, or role 'sp_addrole_r3' already exists in the current database.)~~


SELECT rolname, type, orig_username, database_name
FROM sys.babelfish_authid_user_ext
WHERE orig_username = 'sp_addrole_r3'
GO
~~START~~
varchar#!#char#!#nvarchar#!#nvarchar
master_sp_addrole_r3#!#R#!#sp_addrole_r3#!#master
~~END~~

