-- tsql
create table test_int_numeric(a int);
GO

-- insert 1M rows of data
INSERT INTO test_int_numeric (a) SELECT generate_series(1, 1000000);
GO
~~ROW COUNT: 1000000~~


INSERT INTO test_int_numeric VALUES (NULL), (-2147483648), (2147483647);
GO
~~ROW COUNT: 3~~


CREATE INDEX test_int_numeric_idx on test_int_numeric(a);
GO

-- psql
analyse;
GO

-- tsql
select set_config('max_parallel_workers_per_gather', '0', false);
GO
~~START~~
text
0
~~END~~

SELECT set_config('debug_parallel_query', '0', false);
GO
~~START~~
text
off
~~END~~


SELECT set_config('babelfishpg_tsql.explain_costs', 'off', false)
GO
~~START~~
text
off
~~END~~


SET BABELFISH_SHOWPLAN_ALL on
GO

select count(*) from test_int_numeric where a IS NULL;
GO
~~START~~
text
Query Text: select count(*) from test_int_numeric where a IS NULL
Aggregate
  ->  Index Only Scan using test_int_numeric_idxtest_int_nu72fc1a67b46827b2c8511b931e7e1f4b on test_int_numeric
        Index Cond: (a IS NULL)
~~END~~


-- seq scan
select count(*) from test_int_numeric where a <> 5.0;
GO
~~START~~
text
Query Text: select count(*) from test_int_numeric where a <> 5.0
Aggregate
  ->  Seq Scan on test_int_numeric
        Filter: (a <> 5.0)
~~END~~


-- index scan on < and >
select count(*) from test_int_numeric where a < 5.0;
GO
~~START~~
text
Query Text: select count(*) from test_int_numeric where a < 5.0
Aggregate
  ->  Index Only Scan using test_int_numeric_idxtest_int_nu72fc1a67b46827b2c8511b931e7e1f4b on test_int_numeric
        Index Cond: (a < 5.0)
~~END~~


select count(*) from test_int_numeric where a < -2147483648.0;
GO
~~START~~
text
Query Text: select count(*) from test_int_numeric where a < -2147483648.0
Aggregate
  ->  Index Only Scan using test_int_numeric_idxtest_int_nu72fc1a67b46827b2c8511b931e7e1f4b on test_int_numeric
        Index Cond: (a < '-2147483648.0'::numeric)
~~END~~


select count(*) from test_int_numeric where a <= 5.0;
GO
~~START~~
text
Query Text: select count(*) from test_int_numeric where a <= 5.0
Aggregate
  ->  Index Only Scan using test_int_numeric_idxtest_int_nu72fc1a67b46827b2c8511b931e7e1f4b on test_int_numeric
        Index Cond: (a <= 5.0)
~~END~~


select count(*) from test_int_numeric where a > 999995.0;
GO
~~START~~
text
Query Text: select count(*) from test_int_numeric where a > 999995.0
Aggregate
  ->  Index Only Scan using test_int_numeric_idxtest_int_nu72fc1a67b46827b2c8511b931e7e1f4b on test_int_numeric
        Index Cond: (a > 999995.0)
~~END~~


select count(*) from test_int_numeric where a >= 999995.0;
GO
~~START~~
text
Query Text: select count(*) from test_int_numeric where a >= 999995.0
Aggregate
  ->  Index Only Scan using test_int_numeric_idxtest_int_nu72fc1a67b46827b2c8511b931e7e1f4b on test_int_numeric
        Index Cond: (a >= 999995.0)
~~END~~


select count(*) from test_int_numeric where a > 2147483647.0;
go
~~START~~
text
Query Text: select count(*) from test_int_numeric where a > 2147483647.0
Aggregate
  ->  Index Only Scan using test_int_numeric_idxtest_int_nu72fc1a67b46827b2c8511b931e7e1f4b on test_int_numeric
        Index Cond: (a > 2147483647.0)
~~END~~


-- seq scan on < and >
select count(*) from test_int_numeric where a > 5.0;
GO
~~START~~
text
Query Text: select count(*) from test_int_numeric where a > 5.0
Aggregate
  ->  Seq Scan on test_int_numeric
        Filter: (a > 5.0)
~~END~~


-- index scan for BETWEEN
select count(*) from test_int_numeric where a between 5.0 and 10.0;
GO
~~START~~
text
Query Text: select count(*) from test_int_numeric where a between 5.0 and 10.0
Aggregate
  ->  Index Only Scan using test_int_numeric_idxtest_int_nu72fc1a67b46827b2c8511b931e7e1f4b on test_int_numeric
        Index Cond: ((a >= 5.0) AND (a <= 10.0))
~~END~~


-- seq scan for BETWEEN
select count(*) from test_int_numeric where a between 5.0 and 999999.0;
GO
~~START~~
text
Query Text: select count(*) from test_int_numeric where a between 5.0 and 999999.0
Aggregate
  ->  Seq Scan on test_int_numeric
        Filter: ((a >= 5.0) AND (a <= 999999.0))
~~END~~


-- mix of int op numeric and int op int
select count(*) from test_int_numeric where (a between 5.0 and 999999.0) and a = 10;
GO
~~START~~
text
Query Text: select count(*) from test_int_numeric where (a between 5.0 and 999999.0) and a = 10
Aggregate
  ->  Index Only Scan using test_int_numeric_idxtest_int_nu72fc1a67b46827b2c8511b931e7e1f4b on test_int_numeric
        Index Cond: ((a >= 5.0) AND (a <= 999999.0) AND (a = 10))
~~END~~


select count(*) from test_int_numeric where a > 5.0 and a < 7;
Go
~~START~~
text
Query Text: select count(*) from test_int_numeric where a > 5.0 and a < 7
Aggregate
  ->  Index Only Scan using test_int_numeric_idxtest_int_nu72fc1a67b46827b2c8511b931e7e1f4b on test_int_numeric
        Index Cond: ((a > 5.0) AND (a < 7))
~~END~~



-- shouldn't be any regression on int op int operators
-- seq scan
select count(*) from test_int_numeric where a <> 5;
GO
~~START~~
text
Query Text: select count(*) from test_int_numeric where a <> 5
Aggregate
  ->  Seq Scan on test_int_numeric
        Filter: (a <> 5)
~~END~~


-- index scan on < and >
select count(*) from test_int_numeric where a < 5;
GO
~~START~~
text
Query Text: select count(*) from test_int_numeric where a < 5
Aggregate
  ->  Index Only Scan using test_int_numeric_idxtest_int_nu72fc1a67b46827b2c8511b931e7e1f4b on test_int_numeric
        Index Cond: (a < 5)
~~END~~


select count(*) from test_int_numeric where a < -2147483648;
GO
~~START~~
text
Query Text: select count(*) from test_int_numeric where a < -2147483648
Aggregate
  ->  Index Only Scan using test_int_numeric_idxtest_int_nu72fc1a67b46827b2c8511b931e7e1f4b on test_int_numeric
        Index Cond: (a < '-2147483648'::integer)
~~END~~


select count(*) from test_int_numeric where a <= 5;
GO
~~START~~
text
Query Text: select count(*) from test_int_numeric where a <= 5
Aggregate
  ->  Index Only Scan using test_int_numeric_idxtest_int_nu72fc1a67b46827b2c8511b931e7e1f4b on test_int_numeric
        Index Cond: (a <= 5)
~~END~~


select count(*) from test_int_numeric where a > 999995;
GO
~~START~~
text
Query Text: select count(*) from test_int_numeric where a > 999995
Aggregate
  ->  Index Only Scan using test_int_numeric_idxtest_int_nu72fc1a67b46827b2c8511b931e7e1f4b on test_int_numeric
        Index Cond: (a > 999995)
~~END~~


select count(*) from test_int_numeric where a >= 999995;
GO
~~START~~
text
Query Text: select count(*) from test_int_numeric where a >= 999995
Aggregate
  ->  Index Only Scan using test_int_numeric_idxtest_int_nu72fc1a67b46827b2c8511b931e7e1f4b on test_int_numeric
        Index Cond: (a >= 999995)
~~END~~


select count(*) from test_int_numeric where a > 2147483647;
go
~~START~~
text
Query Text: select count(*) from test_int_numeric where a > 2147483647
Aggregate
  ->  Index Only Scan using test_int_numeric_idxtest_int_nu72fc1a67b46827b2c8511b931e7e1f4b on test_int_numeric
        Index Cond: (a > 2147483647)
~~END~~


-- seq scan on < and >
select count(*) from test_int_numeric where a > 5;
GO
~~START~~
text
Query Text: select count(*) from test_int_numeric where a > 5
Aggregate
  ->  Seq Scan on test_int_numeric
        Filter: (a > 5)
~~END~~


-- index scan for BETWEEN
select count(*) from test_int_numeric where a between 5 and 10;
GO
~~START~~
text
Query Text: select count(*) from test_int_numeric where a between 5 and 10
Aggregate
  ->  Index Only Scan using test_int_numeric_idxtest_int_nu72fc1a67b46827b2c8511b931e7e1f4b on test_int_numeric
        Index Cond: ((a >= 5) AND (a <= 10))
~~END~~


-- seq scan for BETWEEN
select count(*) from test_int_numeric where a between 5 and 999999;
GO
~~START~~
text
Query Text: select count(*) from test_int_numeric where a between 5 and 999999
Aggregate
  ->  Seq Scan on test_int_numeric
        Filter: ((a >= 5) AND (a <= 999999))
~~END~~


SET BABELFISH_SHOWPLAN_ALL OFF
GO


-- actual execution
select count(*) from test_int_numeric where a IS NULL;
GO
~~START~~
int
1
~~END~~


-- seq scan
select count(*) from test_int_numeric where a <> 5.0;
GO
~~START~~
int
1000001
~~END~~


-- index scan on < and >
select count(*) from test_int_numeric where a < 5.0;
GO
~~START~~
int
5
~~END~~


select count(*) from test_int_numeric where a < -2147483648.0;
GO
~~START~~
int
0
~~END~~


select count(*) from test_int_numeric where a <= 5.0;
GO
~~START~~
int
6
~~END~~


select count(*) from test_int_numeric where a > 999995.0;
GO
~~START~~
int
6
~~END~~


select count(*) from test_int_numeric where a >= 999995.0;
GO
~~START~~
int
7
~~END~~


select count(*) from test_int_numeric where a > 2147483647.0;
go
~~START~~
int
0
~~END~~


-- seq scan on < and >
select count(*) from test_int_numeric where a > 5.0;
GO
~~START~~
int
999996
~~END~~


-- index scan for BETWEEN
select count(*) from test_int_numeric where a between 5.0 and 10.0;
GO
~~START~~
int
6
~~END~~


-- seq scan for BETWEEN
select count(*) from test_int_numeric where a between 5.0 and 999999.0;
GO
~~START~~
int
999995
~~END~~


-- mix of int op numeric and int op int
select count(*) from test_int_numeric where (a between 5.0 and 999999.0) and a = 10;
GO
~~START~~
int
1
~~END~~


select count(*) from test_int_numeric where a > 5.0 and a < 7;
Go
~~START~~
int
1
~~END~~



-- shouldn't be any regression on int op int operators
-- seq scan
select count(*) from test_int_numeric where a <> 5;
GO
~~START~~
int
1000001
~~END~~


-- index scan on < and >
select count(*) from test_int_numeric where a < 5;
GO
~~START~~
int
5
~~END~~


select count(*) from test_int_numeric where a < -2147483648;
GO
~~START~~
int
0
~~END~~


select count(*) from test_int_numeric where a <= 5;
GO
~~START~~
int
6
~~END~~


select count(*) from test_int_numeric where a > 999995;
GO
~~START~~
int
6
~~END~~


select count(*) from test_int_numeric where a >= 999995;
GO
~~START~~
int
7
~~END~~


select count(*) from test_int_numeric where a > 2147483647;
go
~~START~~
int
0
~~END~~


-- seq scan on < and >
select count(*) from test_int_numeric where a > 5;
GO
~~START~~
int
999996
~~END~~


-- index scan for BETWEEN
select count(*) from test_int_numeric where a between 5 and 10;
GO
~~START~~
int
6
~~END~~


-- seq scan for BETWEEN
select count(*) from test_int_numeric where a between 5 and 999999;
GO
~~START~~
int
999995
~~END~~


DROP TABLE test_int_numeric
go
