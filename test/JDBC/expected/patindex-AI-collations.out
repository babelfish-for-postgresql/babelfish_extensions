
-- BASIC TESTS
-- [] wildcard single character to match or not match
SELECT PATINDEX('%[A-Z]%', 'a' COLLATE Latin1_General_CI_AI)
SELECT PATINDEX('%[A-Z]%', 'b' COLLATE Latin1_General_CI_AI)
SELECT PATINDEX('%[A-Z]%', 'z' COLLATE Latin1_General_CI_AI)
SELECT PATINDEX('[^A-Z]', 'z' COLLATE Latin1_General_CI_AI)
SELECT PATINDEX('[^A-Z]', 'A' COLLATE Latin1_General_CI_AI)
SELECT PATINDEX('[^A-Z]', 'b' COLLATE Latin1_General_CI_AI)
GO
~~START~~
bigint
1
~~END~~

~~START~~
bigint
1
~~END~~

~~START~~
bigint
1
~~END~~

~~START~~
bigint
0
~~END~~

~~START~~
bigint
0
~~END~~

~~START~~
bigint
0
~~END~~


-- _ wildcard one single character to match
SELECT PATINDEX('_', 'b' COLLATE Latin1_General_CI_AI)
SELECT PATINDEX('%[A-Z]_[^A-Y]%', 'aB≈æ' COLLATE Latin1_General_CI_AI)
SELECT PATINDEX('%aZƒè_[^A-Y]%', 'hqy√Åzdjz' COLLATE Latin1_General_CI_AI)
GO
~~START~~
bigint
1
~~END~~

~~START~~
bigint
1
~~END~~

~~START~~
bigint
4
~~END~~


-- _ wildcard one single character to match
SELECT PATINDEX('_', 'ƒõ' COLLATE Latin1_General_CI_AI)
SELECT PATINDEX('%[A-Z]_[^A-Y]%', '√¢Bz' COLLATE Latin1_General_CI_AI)
SELECT PATINDEX('%aZƒè_[^A-Y]%', 'hqy√¢zdj≈º' COLLATE Latin1_General_CI_AI)
GO
~~START~~
bigint
1
~~END~~

~~START~~
bigint
1
~~END~~

~~START~~
bigint
4
~~END~~


-- Basic Accent Insensitivity
DECLARE @testString NVARCHAR(100) = 'Caf√© jalape√±o';
SELECT PATINDEX('%caf√©%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 1
SELECT PATINDEX('%jalapeno%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 6
GO
~~START~~
bigint
1
~~END~~

~~START~~
bigint
6
~~END~~


-- Mixed Case and Accent Sensitivity
DECLARE @testString NVARCHAR(100) = 'R√©sum√©';
SELECT PATINDEX('%r√©sum√©%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 1
SELECT PATINDEX('%RESUME%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 1
GO
~~START~~
bigint
1
~~END~~

~~START~~
bigint
1
~~END~~


-- not found
DECLARE @testString NVARCHAR(100) = 'Example string';
SELECT PATINDEX('%notfound%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 0
GO
~~START~~
bigint
0
~~END~~


-- pattern with special character
DECLARE @testString NVARCHAR(100) = 'Price: $100.00';
SELECT PATINDEX('%$100%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 8
SELECT PATINDEX('%100.00%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 9
GO
~~START~~
bigint
8
~~END~~

~~START~~
bigint
9
~~END~~


-- multiple occurrence
DECLARE @testString NVARCHAR(100) = 'Patter√± with pattern and another pattern';
SELECT PATINDEX('%pattern%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 1
GO
~~START~~
bigint
1
~~END~~

DECLARE @testString NVARCHAR(100) = 'patterPatt√®rn with p√¢tt√©rn and another patt√™rn';
SELECT PATINDEX('%pattern%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 7
GO
~~START~~
bigint
7
~~END~~


-- empty null string
DECLARE @testString NVARCHAR(100) = '';
DECLARE @nullString NVARCHAR(100) = NULL;
SELECT PATINDEX('%anything%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 0
SELECT PATINDEX('%anything%', @nullString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: NULL
GO
~~START~~
bigint
0
~~END~~

~~START~~
bigint
<NULL>
~~END~~


-- multiple wild cards
DECLARE @testString NVARCHAR(100) = 'Patte≈ôn matching wi≈•h _ and % wildƒáards';
-- `%` matches any sequence of characters
SELECT PATINDEX('%with %wildcards%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 18
-- `_` matches exactly one character
SELECT PATINDEX('%with _ and %wildcards%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 18
GO
~~START~~
bigint
18
~~END~~

~~START~~
bigint
18
~~END~~




-- Wildcard Combination in Patterns
DECLARE @testString NVARCHAR(100) = 'Example of patt√©rn matching w√¨th speci√°l cases';
-- `%` and `_` used together
SELECT PATINDEX('%patt√™rn%_w√≠th%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 11
-- Single `_` used in the middle
SELECT PATINDEX('%pattern _m√°tching%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 11
GO
~~START~~
bigint
12
~~END~~

~~START~~
bigint
0
~~END~~


-- consecutive wildcards
DECLARE @testString NVARCHAR(100) = 'D√†t√° with multipl√© %% wildca≈ôds';
-- Multiple `%` wildcards
SELECT PATINDEX('%mult√≠ple % wildca·πõds%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 9
GO
~~START~~
bigint
11
~~END~~


-- Leading and Trailing Wildcards
DECLARE @testString NVARCHAR(100) = 'Example ≈ütri√±AEg for t√©sting patterns';
-- Wildcards at both ends
SELECT PATINDEX('%stri≈Ñ√Üg for%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 9
-- Wildcard in the middle
SELECT PATINDEX('%stri≈Ñ√Üg%for%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 9
GO
~~START~~
bigint
9
~~END~~

~~START~~
bigint
9
~~END~~


-- Complex Pattern with Special Characters
DECLARE @testString NVARCHAR(100) = 'Price: $100.00 and $200.00';
-- Pattern with special characters and wildcards
SELECT PATINDEX('%$100.00%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 8
SELECT PATINDEX('%$%.00%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 8 (matches $100.00)
GO
~~START~~
bigint
8
~~END~~

~~START~~
bigint
8
~~END~~


-- Wildcards with Mixed Case
DECLARE @testString NVARCHAR(100) = 'Case Insensitive Pattern Matching';
-- Case-insensitive wildcard match
SELECT PATINDEX('%pattern matƒáhing%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 19
GO
~~START~~
bigint
18
~~END~~


-- Long String with Wildcard
DECLARE @testString NVARCHAR(MAX) = REPLICATE('Long text with many characters to t√©≈°t the p√°ttAern matching functionality. ', 10);
-- Long string with wildcard pattern
SELECT PATINDEX('%te≈õt %the% patt√Ürn%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: Position in the long text
GO
~~START~~
bigint
35
~~END~~


-- Overlapping Patterns
DECLARE @testString NVARCHAR(100) = '123123123';
-- Pattern where `%123%` is overlapping
SELECT PATINDEX('%123123%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 1
GO
~~START~~
bigint
1
~~END~~


-- Escaping Wildcards
DECLARE @testString NVARCHAR(100) = 'Special characters: % and _';
-- Escaping `%` and `_` using a pattern that should match literally
SELECT PATINDEX('%[%]%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 19 (matching `%`)
SELECT PATINDEX('%[_]%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 30 (matching `_`)
GO
~~START~~
bigint
21
~~END~~

~~START~~
bigint
27
~~END~~


-- Wildcard with Special Characters
DECLARE @testString NVARCHAR(100) = 'File name: da»õa_*.txt';
-- Wildcard with special characters
SELECT PATINDEX('%d√°ta_%.≈•xt%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 11
GO
~~START~~
bigint
12
~~END~~


-- Patterns with Trailing Wildcard and Special Characters
DECLARE @testString NVARCHAR(100) = 'Numb√©r: 12345-6789 and 98765-4321';
SELECT PATINDEX('%12345-%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 10
GO
~~START~~
bigint
9
~~END~~



-- Multiple wildcards and special characters
DECLARE @testString NVARCHAR(100) = '123-456_789*012';
SELECT PATINDEX('%-456_789*%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 4
GO
~~START~~
bigint
4
~~END~~


-- Case and accent insensitivity with complex pattern
DECLARE @testString NVARCHAR(100) = 'Acc√©nted words: caf√©, r√©sum√©, jalape√±o';
SELECT PATINDEX('%caf√©%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 18
SELECT PATINDEX('%resume%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 25
GO
~~START~~
bigint
17
~~END~~

~~START~~
bigint
23
~~END~~



DECLARE @testString NVARCHAR(100) = 'Null and empty string patterns';
-- Null pattern
DECLARE @nullPattern NVARCHAR(100) = NULL;
SELECT PATINDEX(@nullPattern, @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 0
-- Empty pattern
DECLARE @emptyPattern NVARCHAR(100) = '';
SELECT PATINDEX(@emptyPattern, @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 1
GO
~~START~~
bigint
<NULL>
~~END~~

~~START~~
bigint
0
~~END~~


-- Nested wildcards
DECLARE @testString NVARCHAR(100) = 'Pattern example: a1b2c3d4e5';
SELECT PATINDEX('%a1%b2%c3%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 1 (matches "a1b2c3")
SELECT PATINDEX('%a1_b2%c3_%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 1 (matches "a1b2c3")
GO
~~START~~
bigint
18
~~END~~

~~START~~
bigint
0
~~END~~


-- Long pattern with multiple wildcards
DECLARE @testString NVARCHAR(100) = REPLICATE('X', 50) + '√Ω' + REPLICATE('X', 50) + '≈π' + REPLICATE('X', 50);
SELECT PATINDEX('%X%Y%≈ª%', @testString COLLATE Latin1_General_CI_AI) AS Position; -- Expected: 51 (matches "Y" and "Z")
GO
~~START~~
bigint
0
~~END~~



-- Pattern with digit ranges
DECLARE @testString NVARCHAR(100) = 'Order numbers: 123, 456, 789';
SELECT PATINDEX('%[1-3][0-9][0-9]%', @testString COLLATE Latin1_General_CI_AI)  -- Expected: Match Found
GO
~~START~~
bigint
16
~~END~~



-- Pattern with letter ranges
DECLARE @testString NVARCHAR(100) = 'Alphabet sequence: √¢bC, ƒèEf, GƒßI';
SELECT PATINDEX('%[A-C][A-C][A-C]%', @testString COLLATE Latin1_General_CI_AI) 
GO
~~START~~
bigint
20
~~END~~


-- Pattern with alphanumeric ranges
DECLARE @testString NVARCHAR(100) = 'Code ra≈Ñges: √Å1B2, C3D4, E5F6';
SELECT PATINDEX('%[A-C][1-4][A-C][1-4]%', @testString COLLATE Latin1_General_CI_AI) 
GO
~~START~~
bigint
14
~~END~~


-- Pattern with special characters and ranges
DECLARE @testString NVARCHAR(100) = 'Special ch√°rs: !@#, $%^, &*()';
SELECT PATINDEX('%[!@#][$%^&][*()]%', @testString COLLATE Latin1_General_CI_AI)
GO
~~START~~
bigint
0
~~END~~


SELECT PATINDEX('%√†bƒád%', '   ' COLLATE Latin1_General_CI_AI)
SELECT PATINDEX('%abcd%', 'xyz   ' COLLATE Latin1_General_CI_AI)
GO
~~START~~
bigint
0
~~END~~

~~START~~
bigint
0
~~END~~


SELECT PATINDEX(N'%[A-AE]%', N'√Ü' COLLATE Latin1_General_CI_AI)
SELECT PATINDEX(N'%[AE-E]%', N'√Ü' COLLATE Latin1_General_CI_AI)
GO
~~START~~
bigint
0
~~END~~

~~START~~
bigint
1
~~END~~



-- BASIC TESTS
-- [] wildcard single character to match or not match
SELECT PATINDEX('%[A-Z]%', '√°' COLLATE Latin1_General_CS_AI)
SELECT PATINDEX('%[A-Z]%', 'b' COLLATE Latin1_General_CS_AI)
SELECT PATINDEX('%[A-Z]%', 'z' COLLATE Latin1_General_CS_AI)
SELECT PATINDEX('[^A-Z]', 'z' COLLATE Latin1_General_CS_AI)
SELECT PATINDEX('[^A-Z]', 'A' COLLATE Latin1_General_CS_AI)
SELECT PATINDEX('[^A-Z]', 'b' COLLATE Latin1_General_CS_AI)
GO
~~START~~
bigint
0
~~END~~

~~START~~
bigint
1
~~END~~

~~START~~
bigint
1
~~END~~

~~START~~
bigint
0
~~END~~

~~START~~
bigint
0
~~END~~

~~START~~
bigint
0
~~END~~


-- _ wildcard one single character to match
SELECT PATINDEX('_', 'b' COLLATE Latin1_General_CS_AI)
SELECT PATINDEX('%[A-≈Ω]_[^√Ä-Y]%', 'aBz' COLLATE Latin1_General_CS_AI)
SELECT PATINDEX('%√°Zƒè_[^√Å-Y]%', 'hqya≈ædj≈æ' COLLATE Latin1_General_CS_AI)
GO
~~START~~
bigint
1
~~END~~

~~START~~
bigint
0
~~END~~

~~START~~
bigint
0
~~END~~


-- _ wildcard one single character to match
SELECT PATINDEX('_', 'b' COLLATE Latin1_General_CS_AI)
SELECT PATINDEX('%[A-Z]_[^A-Y]%', '√°B≈º' COLLATE Latin1_General_CS_AI)
SELECT PATINDEX('%aZƒè_[^A-Y]%', 'hqyazdjz' COLLATE Latin1_General_CS_AI)
GO
~~START~~
bigint
1
~~END~~

~~START~~
bigint
0
~~END~~

~~START~~
bigint
0
~~END~~


-- Basic Accent Insensitivity
DECLARE @testString NVARCHAR(100) = 'Caf√© jalape√±o';
SELECT PATINDEX('%caf√©%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 1
SELECT PATINDEX('%jalapeno%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 6
GO
~~START~~
bigint
0
~~END~~

~~START~~
bigint
6
~~END~~


-- Mixed Case and Accent Sensitivity
DECLARE @testString NVARCHAR(100) = 'R√©sum√©';
SELECT PATINDEX('%r√©sum√©%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 0
SELECT PATINDEX('%RESUME%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 0
SELECT PATINDEX('%Resume%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 1
GO
~~START~~
bigint
0
~~END~~

~~START~~
bigint
0
~~END~~

~~START~~
bigint
1
~~END~~


-- not found
DECLARE @testString NVARCHAR(100) = 'Example string';
SELECT PATINDEX('%notfound%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 0
SELECT PATINDEX('%Example String%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 0
GO
~~START~~
bigint
0
~~END~~

~~START~~
bigint
0
~~END~~


-- pattern with special character
DECLARE @testString NVARCHAR(100) = 'Price: $100.00';
SELECT PATINDEX('%$100%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 8
SELECT PATINDEX('%100.00%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 9
GO
~~START~~
bigint
8
~~END~~

~~START~~
bigint
9
~~END~~


-- multiple occurrence
DECLARE @testString NVARCHAR(100) = 'Pattern with p√°ttern and another pattern';
SELECT PATINDEX('%pattern%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 14
GO
~~START~~
bigint
14
~~END~~

DECLARE @testString NVARCHAR(100) = 'patterPattern with pattern and another pattern';
SELECT PATINDEX('%patt√©rn%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 20
GO
~~START~~
bigint
20
~~END~~


-- empty null string
DECLARE @testString NVARCHAR(100) = '';
DECLARE @nullString NVARCHAR(100) = NULL;
SELECT PATINDEX('%anything%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 0
SELECT PATINDEX('%anything%', @nullString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: NULL
GO
~~START~~
bigint
0
~~END~~

~~START~~
bigint
<NULL>
~~END~~


-- multiple wild cards
DECLARE @testString NVARCHAR(100) = 'Pattern matching w√¨th _ and % wildcards';
-- `%` matches any sequence of characters
SELECT PATINDEX('%witƒß %wild√ßards%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 18
-- `_` matches exactly one character
SELECT PATINDEX('%with _ and %wildcards%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 18
GO
~~START~~
bigint
18
~~END~~

~~START~~
bigint
18
~~END~~




-- Wildcard Combination in Patterns
DECLARE @testString NVARCHAR(100) = 'Example of pattern matching with special cases';
-- `%` and `_` used together
SELECT PATINDEX('%pattern%_with%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 11
-- Single `_` used in the middle
SELECT PATINDEX('%pattern _matching%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 11
GO
~~START~~
bigint
12
~~END~~

~~START~~
bigint
0
~~END~~


-- consecutive wildcards
DECLARE @testString NVARCHAR(100) = 'Data with multiple %% wildcards';
-- Multiple `%` wildcards
SELECT PATINDEX('%multiple % wildcards%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 9
GO
~~START~~
bigint
11
~~END~~


-- Leading and Trailing Wildcards
DECLARE @testString NVARCHAR(100) = 'Example string for testing patterns';
-- Wildcards at both ends
SELECT PATINDEX('%string for%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 9
-- Wildcard in the middle
SELECT PATINDEX('%string%for%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 9
GO
~~START~~
bigint
9
~~END~~

~~START~~
bigint
9
~~END~~


-- Complex Pattern with Special Characters
DECLARE @testString NVARCHAR(100) = 'Price: $100.00 and $200.00';
-- Pattern with special characters and wildcards
SELECT PATINDEX('%$100.00%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 8
SELECT PATINDEX('%$%.00%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 8 (matches $100.00)
GO
~~START~~
bigint
8
~~END~~

~~START~~
bigint
8
~~END~~


-- Wildcards with Mixed Case
DECLARE @testString NVARCHAR(100) = 'Case Insensitive Pattern Matching';
-- Case-insensitive wildcard match
SELECT PATINDEX('%pattern matching%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 19
GO
~~START~~
bigint
0
~~END~~


-- Long String with Wildcard
DECLARE @testString NVARCHAR(MAX) = REPLICATE('Long text with many characters to t√©st the pattern matching functionality. ', 10);
-- Long string with wildcard pattern
SELECT PATINDEX('%te≈üt %th√©% pattern%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: Position in the long text
GO
~~START~~
bigint
35
~~END~~


-- Overlapping Patterns
DECLARE @testString NVARCHAR(100) = '123123123';
-- Pattern where `%123%` is overlapping
SELECT PATINDEX('%123123%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 1
GO
~~START~~
bigint
1
~~END~~


-- Escaping Wildcards
DECLARE @testString NVARCHAR(100) = 'Special characters: % and _';
-- Escaping `%` and `_` using a pattern that should match literally
SELECT PATINDEX('%[%]%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 19 (matching `%`)
SELECT PATINDEX('%[_]%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 30 (matching `_`)
GO
~~START~~
bigint
21
~~END~~

~~START~~
bigint
27
~~END~~


-- Wildcard with Special Characters
DECLARE @testString NVARCHAR(100) = 'File name: data_*.txt';
-- Wildcard with special characters
SELECT PATINDEX('%data_%.txt%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 11
GO
~~START~~
bigint
12
~~END~~


-- Patterns with Trailing Wildcard and Special Characters
DECLARE @testString NVARCHAR(100) = 'Number: 12345-6789 and 98765-4321';
SELECT PATINDEX('%12345-%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 10
GO
~~START~~
bigint
9
~~END~~



-- Multiple wildcards and special characters
DECLARE @testString NVARCHAR(100) = '123-456_789*012';
SELECT PATINDEX('%-456_789*%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 4
GO
~~START~~
bigint
4
~~END~~


-- Case and accent insensitivity with complex pattern
DECLARE @testString NVARCHAR(100) = 'Acc√©nted words: caf√©, r√©sum√©, jalape√±o';
SELECT PATINDEX('%caf√©%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 18
SELECT PATINDEX('%resume%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 25
GO
~~START~~
bigint
17
~~END~~

~~START~~
bigint
23
~~END~~



DECLARE @testString NVARCHAR(100) = 'Null and empty string patterns';
-- Null pattern
DECLARE @nullPattern NVARCHAR(100) = NULL;
SELECT PATINDEX(@nullPattern, @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 0
-- Empty pattern
DECLARE @emptyPattern NVARCHAR(100) = '';
SELECT PATINDEX(@emptyPattern, @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 1
GO
~~START~~
bigint
<NULL>
~~END~~

~~START~~
bigint
0
~~END~~


-- Nested wildcards
DECLARE @testString NVARCHAR(100) = 'Pattern example: a1b2c3d4e5';
SELECT PATINDEX('%a1%b2%c3%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 1 (matches "a1b2c3")
SELECT PATINDEX('%a1_b2%c3_%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 1 (matches "a1b2c3")
GO
~~START~~
bigint
18
~~END~~

~~START~~
bigint
0
~~END~~


-- Long pattern with multiple wildcards
DECLARE @testString NVARCHAR(100) = REPLICATE('X', 50) + '√ù' + REPLICATE('X', 50) + 'Z' + REPLICATE('X', 50);
SELECT PATINDEX('%X%Y%Z%', @testString COLLATE Latin1_General_CS_AI) AS Position; -- Expected: 51 (matches "Y" and "Z")
GO
~~START~~
bigint
0
~~END~~



-- Pattern with digit ranges
DECLARE @testString NVARCHAR(100) = 'Order numbers: 123, 456, 789';
SELECT PATINDEX('%[1-3][0-9][0-9]%', @testString COLLATE Latin1_General_CS_AI)  -- Expected: Match Found
GO
~~START~~
bigint
16
~~END~~



-- Pattern with letter ranges
DECLARE @testString NVARCHAR(100) = 'Alphabet sequence: ABƒÜ, DEF, GHI';
SELECT PATINDEX('%[A-C][A-C][A-C]%', @testString COLLATE Latin1_General_CS_AI) 
GO
~~START~~
bigint
20
~~END~~


-- Pattern with alphanumeric ranges
DECLARE @testString NVARCHAR(100) = 'Code ranges: A1B2, C3D4, E5F6';
SELECT PATINDEX('%[A-C][1-4][A-C][1-4]%', @testString COLLATE Latin1_General_CS_AI) 
GO
~~START~~
bigint
14
~~END~~


-- Pattern with special characters and ranges
DECLARE @testString NVARCHAR(100) = 'Special chars: !@#, $%^, &*()';
SELECT PATINDEX('%[!@#][$%^&][*()]%', @testString COLLATE Latin1_General_CS_AI)
GO
~~START~~
bigint
0
~~END~~


SELECT PATINDEX('%abƒád%', '   ' COLLATE Latin1_General_CS_AI)
SELECT PATINDEX('%abcd%', 'xyz   ' COLLATE Latin1_General_CS_AI)
GO
~~START~~
bigint
0
~~END~~

~~START~~
bigint
0
~~END~~



SELECT PATINDEX(N'%[a-ae]%', N'√Ü' COLLATE Latin1_General_CI_AI)
SELECT PATINDEX(N'%[A-AE]%', N'√Ü' COLLATE Latin1_General_CI_AI)
SELECT PATINDEX(N'%[ae-e]%', N'√Ü' COLLATE Latin1_General_CI_AI)
SELECT PATINDEX(N'%[AE-E]%', N'√Ü' COLLATE Latin1_General_CI_AI)
GO
~~START~~
bigint
0
~~END~~

~~START~~
bigint
0
~~END~~

~~START~~
bigint
1
~~END~~

~~START~~
bigint
1
~~END~~


SELECT PATINDEX(N'%[-AE]%', N'√Ü' COLLATE Latin1_General_CI_AI)
SELECT PATINDEX(N'%%', N'√Ü' COLLATE Latin1_General_CI_AI)
GO
~~START~~
bigint
1
~~END~~

~~START~~
bigint
1
~~END~~


SELECT PATINDEX('[a-', '[a-' COLLATE Latin1_General_CI_AI)
SELECT PATINDEX('[a-]', '-' COLLATE Latin1_General_CI_AI)
GO
~~START~~
bigint
0
~~END~~

~~START~~
bigint
1
~~END~~


CREATE TABLE #TestStrings (
    Id INT PRIMARY KEY,
    TestText NVARCHAR(100)
);
GO

INSERT INTO #TestStrings (Id, TestText) VALUES
(1, N'√áalƒ±≈ükan'),
(2, N'kalem'),
(3, N'K√úT√úPHANE'),
(4, N'√ñrnek'),
(5, N'√ßalƒ±≈ükan'),
(6, N'kalem'),
(7, N'√∂Rnek');
GO
~~ROW COUNT: 7~~


SELECT Id, TestText,
       PATINDEX(N'%√ßalƒ±≈ü%', TestText COLLATE Turkish_CI_AI) AS Position
FROM #TestStrings;
GO
~~START~~
int#!#nvarchar#!#bigint
1#!#√áalƒ±≈ükan#!#1
2#!#kalem#!#0
3#!#K√úT√úPHANE#!#0
4#!#√ñrnek#!#0
5#!#√ßalƒ±≈ükan#!#1
6#!#kalem#!#0
7#!#√∂Rnek#!#0
~~END~~



SELECT Id, TestText,
       PATINDEX(N'%√ßalƒ±≈ü%' COLLATE Turkish_CI_AI, TestText) AS Position
FROM #TestStrings;
DROP TABLE #TestStrings
GO
~~START~~
int#!#nvarchar#!#bigint
1#!#√áalƒ±≈ükan#!#1
2#!#kalem#!#0
3#!#K√úT√úPHANE#!#0
4#!#√ñrnek#!#0
5#!#√ßalƒ±≈ükan#!#1
6#!#kalem#!#0
7#!#√∂Rnek#!#0
~~END~~


CREATE TABLE #TestStrings (
    Id INT PRIMARY KEY,
    TestText NVARCHAR(100) COLLATE Turkish_CI_AI
);
GO

INSERT INTO #TestStrings (Id, TestText) VALUES
(1, N'√áalƒ±≈ükan'),
(2, N'kalem'),
(3, N'K√úT√úPHANE'),
(4, N'√ñrnek'),
(5, N'√ßalƒ±≈ükan'),
(6, N'kalem'),
(7, N'√∂Rnek');
GO
~~ROW COUNT: 7~~


SELECT Id, TestText,
       PATINDEX(N'%√ßalƒ±≈ü%', TestText) AS Position
FROM #TestStrings;
GO
~~START~~
int#!#nvarchar#!#bigint
1#!#√áalƒ±≈ükan#!#1
2#!#kalem#!#0
3#!#K√úT√úPHANE#!#0
4#!#√ñrnek#!#0
5#!#√ßalƒ±≈ükan#!#1
6#!#kalem#!#0
7#!#√∂Rnek#!#0
~~END~~



-- Computed columns
CREATE TABLE babel_5118_with_computed_col (pattern NVARCHAR(100), src NVARCHAR(100), patindex AS PATINDEX(pattern, src COLLATE Latin1_General_CS_AI))
GO

INSERT INTO babel_5118_with_computed_col (pattern, src)
VALUES
    ('%[A-C][A-C][A-C]%', 'Alphabet sequence: ABƒÜ, DEF, GHI'),
    ('%pattern%_with%', 'Example of pattern matching with special cases'),
    ('_','b');
GO
~~ROW COUNT: 3~~


-- Check constraints
ALTER TABLE babel_5118_with_computed_col ADD CONSTRAINT chkRowCount CHECK (PATINDEX(pattern, src COLLATE Latin1_General_CS_AI) >= 1);
GO

INSERT INTO babel_5118_with_computed_col (pattern, src) VALUES ('_a','b');
GO
~~ERROR (Code: 547)~~

~~ERROR (Message: new row for relation "babel_5118_with_computed_col" violates check constraint "chkrowcount")~~


INSERT INTO babel_5118_with_computed_col (pattern, src) VALUES ('_','b');
GO
~~ROW COUNT: 1~~


CREATE VIEW babel_5118_VIEW AS SELECT pattern, src, PATINDEX(pattern, src COLLATE Latin1_General_CS_AI) AS PATINDEX FROM babel_5118_with_computed_col ORDER BY pattern
GO

SELECT * FROM babel_5118_VIEW
GO
~~START~~
nvarchar#!#nvarchar#!#bigint
_#!#b#!#1
_#!#b#!#1
%[A-C][A-C][A-C]%#!#Alphabet sequence: ABƒÜ, DEF, GHI#!#20
%pattern%_with%#!#Example of pattern matching with special cases#!#12
~~END~~


CREATE PROCEDURE babel_5118_with_proc
AS
SELECT pattern, src, PATINDEX(pattern, src COLLATE Latin1_General_CS_AI) AS PATINDEX FROM babel_5118_with_computed_col ORDER BY pattern
GO

EXEC babel_5118_with_proc
GO
~~START~~
nvarchar#!#nvarchar#!#bigint
_#!#b#!#1
_#!#b#!#1
%[A-C][A-C][A-C]%#!#Alphabet sequence: ABƒÜ, DEF, GHI#!#20
%pattern%_with%#!#Example of pattern matching with special cases#!#12
~~END~~


DROP VIEW babel_5118_VIEW
GO

DROP PROCEDURE babel_5118_with_proc
GO

DROP TABLE babel_5118_with_computed_col
GO

-- CONCAT INSIDE PATINDEX
SELECT PATINDEX(N'%[A-C]%_%[^A-Y]%Z%', CONCAT(REPEAT('b', 50), REPEAT('A', 50), REPEAT('Z', 50), REPEAT('Z', 50)) COLLATE Latin1_General_CI_AI)
GO
~~START~~
bigint
1
~~END~~


-- Surrogate pair charcters
SELECT PATINDEX(N'%üòÄ%', N'üòÄ' COLLATE Latin1_General_CI_AI)
SELECT PATINDEX(N'%Z%', N'ABCüòÄZABC' COLLATE Latin1_General_CI_AI)
GO
~~START~~
bigint
1
~~END~~

~~START~~
bigint
5
~~END~~

