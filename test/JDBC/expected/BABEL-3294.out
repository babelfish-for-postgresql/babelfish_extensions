drop table if exists babel_3294_t1
go

create table babel_3294_t1(a1 int)
go

alter table babel_3294_t1 set (parallel_workers = 16)
go

select set_config('force_parallel_mode', '1', false)
go
~~START~~
text
on
~~END~~


select set_config('parallel_setup_cost', '0', false)
go
~~START~~
text
0
~~END~~


select set_config('parallel_tuple_cost', '0', false)
go
~~START~~
text
0
~~END~~


select set_config('babelfishpg_tsql.enable_hint_mapping', 'on', false)
go
~~START~~
text
on
~~END~~


set babelfish_showplan_all on
go

select * from babel_3294_t1 t1 where a1 = 1 option(maxdop 1)
go
~~START~~
text
Query Text: /*+ Set(max_parallel_workers_per_gather 1) */ select * from babel_3294_t1 t1 where a1 = 1                 
Gather  (cost=0.00..28.75 rows=13 width=4)
  Workers Planned: 1
  ->  Parallel Seq Scan on babel_3294_t1 t1  (cost=0.00..28.75 rows=8 width=4)
        Filter: (a1 = 1)
~~END~~


select * from babel_3294_t1 t1 where a1 = 1 option(maxdop 2)
go
~~START~~
text
Query Text: /*+ Set(max_parallel_workers_per_gather 2) */ select * from babel_3294_t1 t1 where a1 = 1                 
Gather  (cost=0.00..23.28 rows=13 width=4)
  Workers Planned: 2
  ->  Parallel Seq Scan on babel_3294_t1 t1  (cost=0.00..23.28 rows=5 width=4)
        Filter: (a1 = 1)
~~END~~


select * from babel_3294_t1 t1 where a1 = 1 option(maxdop 4)
go
~~START~~
text
Query Text: /*+ Set(max_parallel_workers_per_gather 4) */ select * from babel_3294_t1 t1 where a1 = 1                 
Gather  (cost=0.00..17.97 rows=13 width=4)
  Workers Planned: 4
  ->  Parallel Seq Scan on babel_3294_t1 t1  (cost=0.00..17.97 rows=3 width=4)
        Filter: (a1 = 1)
~~END~~


select * from babel_3294_t1 t1 where a1 = 1 option(maxdop 8)
go
~~START~~
text
Query Text: /*+ Set(max_parallel_workers_per_gather 8) */ select * from babel_3294_t1 t1 where a1 = 1                 
Gather  (cost=0.00..13.98 rows=13 width=4)
  Workers Planned: 8
  ->  Parallel Seq Scan on babel_3294_t1 t1  (cost=0.00..13.98 rows=2 width=4)
        Filter: (a1 = 1)
~~END~~


select * from babel_3294_t1 t1 where a1 = 1 option(maxdop 16)
go
~~START~~
text
Query Text: /*+ Set(max_parallel_workers_per_gather 16) */ select * from babel_3294_t1 t1 where a1 = 1                  
Gather  (cost=0.00..11.99 rows=13 width=4)
  Workers Planned: 16
  ->  Parallel Seq Scan on babel_3294_t1 t1  (cost=0.00..11.99 rows=1 width=4)
        Filter: (a1 = 1)
~~END~~


select * from babel_3294_t1 t1 where a1 = 1 option(maxdop 20)
go
~~START~~
text
Query Text: /*+ Set(max_parallel_workers_per_gather 20) */ select * from babel_3294_t1 t1 where a1 = 1                  
Gather  (cost=0.00..11.99 rows=13 width=4)
  Workers Planned: 16
  ->  Parallel Seq Scan on babel_3294_t1 t1  (cost=0.00..11.99 rows=1 width=4)
        Filter: (a1 = 1)
~~END~~


set babelfish_showplan_all off
go

-- cleanup
select set_config('force_parallel_mode', '0', false)
go
~~START~~
text
off
~~END~~


select set_config('babelfishpg_tsql.enable_hint_mapping', 'off', false)
go
~~START~~
text
off
~~END~~


drop table babel_3294_t1
go
