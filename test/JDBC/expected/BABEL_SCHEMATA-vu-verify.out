use db_10;
go

-- should show schema_11 and schema_12, since we are inside db_10 database
select * from information_schema.schemata where SCHEMA_NAME NOT LIKE '%_vu_prepare%' AND SCHEMA_NAME NOT LIKE '%objectproperty%' AND SCHEMA_NAME NOT LIKE '%babel%' AND SCHEMA_NAME NOT LIKE '%_proc_%' AND SCHEMA_NAME NOT LIKE '%resolution%' AND SCHEMA_NAME NOT LIKE 'sch1%' AND SCHEMA_NAME NOT LIKE '%sc1%' AND SCHEMA_NAME NOT LIKE '%custom\\schema%' ORDER BY SCHEMA_NAME;
go
~~START~~
varchar#!#nvarchar#!#nvarchar#!#varchar#!#varchar#!#varchar
db_10#!#dbo#!#dbo#!#<NULL>#!#<NULL>#!#<NULL>
db_10#!#information_schema_tsql#!#information_schema_tsql#!#<NULL>#!#<NULL>#!#<NULL>
db_10#!#schema_11#!#dbo#!#<NULL>#!#<NULL>#!#<NULL>
db_10#!#schema_12#!#user1#!#<NULL>#!#<NULL>#!#<NULL>
db_10#!#sys#!#sys#!#<NULL>#!#<NULL>#!#<NULL>
~~END~~


use master;
go

-- should not show schema_11 and schema_12, since we have switched to master database
select * from information_schema.schemata where SCHEMA_NAME NOT LIKE '%_vu_prepare%' AND SCHEMA_NAME NOT LIKE '%objectproperty%' AND SCHEMA_NAME NOT LIKE '%babel%' AND SCHEMA_NAME NOT LIKE '%_proc_%' AND SCHEMA_NAME NOT LIKE '%resolution%' AND SCHEMA_NAME NOT LIKE 'sch1%' AND SCHEMA_NAME NOT LIKE '%sc1%' AND SCHEMA_NAME NOT LIKE '%custom\\schema%' ORDER BY SCHEMA_NAME;
go
~~START~~
varchar#!#nvarchar#!#nvarchar#!#varchar#!#varchar#!#varchar
master#!#dbo#!#dbo#!#<NULL>#!#<NULL>#!#<NULL>
master#!#information_schema_tsql#!#information_schema_tsql#!#<NULL>#!#<NULL>#!#<NULL>
master#!#schema_13#!#dbo#!#<NULL>#!#<NULL>#!#<NULL>
master#!#sys#!#sys#!#<NULL>#!#<NULL>#!#<NULL>
~~END~~


-- tsql      user=schemata_login      password=123
-- Test if user default schema is not dbo schema
-- Check if after revoking the usage permission/ownership from user, it is still showing in catalog or not.
USE master;
GO

SELECT current_user;
GO
~~START~~
varchar
schemata_user
~~END~~


SELECT schema_name();
GO
~~START~~
varchar
schema_13
~~END~~


select * from information_schema.schemata where SCHEMA_NAME NOT LIKE '%_vu_prepare%' AND SCHEMA_NAME NOT LIKE '%objectproperty%' AND SCHEMA_NAME NOT LIKE '%babel%' AND SCHEMA_NAME NOT LIKE '%_proc_%' AND SCHEMA_NAME NOT LIKE '%resolution%' AND SCHEMA_NAME NOT LIKE 'sch1%' AND SCHEMA_NAME NOT LIKE '%sc1%' AND SCHEMA_NAME NOT LIKE '%custom\\schema%' ORDER BY SCHEMA_NAME;
GO
~~START~~
varchar#!#nvarchar#!#nvarchar#!#varchar#!#varchar#!#varchar
master#!#dbo#!#dbo#!#<NULL>#!#<NULL>#!#<NULL>
master#!#information_schema_tsql#!#information_schema_tsql#!#<NULL>#!#<NULL>#!#<NULL>
master#!#schema_13#!#dbo#!#<NULL>#!#<NULL>#!#<NULL>
master#!#sys#!#sys#!#<NULL>#!#<NULL>#!#<NULL>
~~END~~


-- psql
REVOKE ALL ON SCHEMA master_schema_13 FROM master_schemata_user;
GO

-- tsql
select * from information_schema.schemata where SCHEMA_NAME NOT LIKE '%_vu_prepare%' AND SCHEMA_NAME NOT LIKE '%objectproperty%' AND SCHEMA_NAME NOT LIKE '%babel%' AND SCHEMA_NAME NOT LIKE '%_proc_%' AND SCHEMA_NAME NOT LIKE '%resolution%' AND SCHEMA_NAME NOT LIKE 'sch1%' AND SCHEMA_NAME NOT LIKE '%sc1%' AND SCHEMA_NAME NOT LIKE '%custom\\schema%' ORDER BY SCHEMA_NAME;
GO
~~START~~
varchar#!#nvarchar#!#nvarchar#!#varchar#!#varchar#!#varchar
master#!#dbo#!#dbo#!#<NULL>#!#<NULL>#!#<NULL>
master#!#information_schema_tsql#!#information_schema_tsql#!#<NULL>#!#<NULL>#!#<NULL>
master#!#schema_13#!#dbo#!#<NULL>#!#<NULL>#!#<NULL>
master#!#sys#!#sys#!#<NULL>#!#<NULL>#!#<NULL>
~~END~~


-- psql
-- Need to terminate active session before cleaning up the login
SELECT pg_terminate_backend(pid) FROM pg_stat_get_activity(NULL)
WHERE sys.suser_name(usesysid) = 'schemata_login' AND backend_type = 'client backend' AND usesysid IS NOT NULL;
GO
~~START~~
bool
t
~~END~~


-- tsql
DROP user schemata_user;
GO

DROP LOGIN schemata_login;
GO
