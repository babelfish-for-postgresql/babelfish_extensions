use pivot_test
GO

-- 2 column in src table pivot
SELECT 'OrderNumbers' AS OrderCountbyStore, [1] AS STORE1, [2] AS STORE2, [3] AS STORE3, [4] AS STORE4, [5] AS STORE5
FROM
(
    SELECT StoreID, OrderID
    FROM StoreReceipt
)AS SrcTable
PIVOT (
    COUNT (OrderID)
    FOR StoreID IN ([1], [2], [3],[4], [5])
) AS pvt
GO
~~START~~
varchar#!#int#!#int#!#int#!#int#!#int
OrderNumbers#!#19#!#19#!#19#!#16#!#14
~~END~~


-- 3 column in src table pivot
SELECT EmployeeID, [2] AS STORE2, [3] AS STORE3, [4] AS STORE4, [5] AS STORE5, [6] AS STORE6
FROM
(
    SELECT EmployeeID, ItemID, StoreID
    FROM StoreReceipt
)AS srctable
PIVOT (
    COUNT (ItemID)
    FOR StoreID IN ([2], [3], [4], [5], [6])
) AS pvt
GO
~~START~~
int#!#int#!#int#!#int#!#int#!#int
200#!#0#!#0#!#2#!#0#!#0
201#!#0#!#0#!#0#!#0#!#0
202#!#1#!#0#!#0#!#0#!#0
203#!#0#!#0#!#0#!#1#!#0
204#!#0#!#1#!#0#!#0#!#1
205#!#0#!#0#!#0#!#0#!#1
207#!#0#!#0#!#0#!#0#!#0
208#!#0#!#1#!#0#!#0#!#0
209#!#0#!#1#!#0#!#0#!#0
210#!#0#!#0#!#0#!#0#!#0
211#!#2#!#0#!#0#!#0#!#0
212#!#0#!#0#!#1#!#0#!#0
213#!#0#!#0#!#1#!#0#!#0
214#!#0#!#1#!#0#!#0#!#0
215#!#0#!#0#!#0#!#0#!#0
216#!#0#!#1#!#0#!#0#!#0
217#!#0#!#0#!#0#!#1#!#0
218#!#0#!#0#!#1#!#0#!#0
219#!#1#!#0#!#0#!#0#!#1
220#!#0#!#0#!#0#!#1#!#0
221#!#0#!#0#!#0#!#0#!#0
222#!#0#!#0#!#1#!#1#!#0
223#!#0#!#0#!#0#!#2#!#0
224#!#0#!#0#!#0#!#0#!#1
225#!#0#!#1#!#0#!#1#!#0
226#!#1#!#0#!#0#!#0#!#0
227#!#0#!#0#!#0#!#0#!#1
228#!#0#!#1#!#0#!#0#!#0
229#!#0#!#0#!#1#!#0#!#0
230#!#1#!#1#!#0#!#0#!#0
231#!#0#!#0#!#0#!#0#!#0
232#!#0#!#0#!#0#!#0#!#1
234#!#0#!#0#!#0#!#0#!#1
235#!#0#!#0#!#0#!#0#!#0
236#!#0#!#0#!#1#!#0#!#0
237#!#1#!#0#!#0#!#0#!#0
238#!#0#!#0#!#1#!#0#!#0
239#!#0#!#0#!#0#!#0#!#0
240#!#0#!#0#!#0#!#0#!#0
241#!#0#!#0#!#0#!#0#!#0
243#!#0#!#0#!#0#!#0#!#0
245#!#0#!#0#!#0#!#0#!#0
246#!#0#!#0#!#0#!#0#!#0
247#!#1#!#0#!#0#!#0#!#0
248#!#0#!#0#!#2#!#0#!#0
249#!#1#!#0#!#0#!#0#!#0
250#!#0#!#0#!#0#!#0#!#2
251#!#1#!#1#!#1#!#0#!#0
252#!#0#!#0#!#0#!#0#!#0
253#!#1#!#0#!#0#!#0#!#0
254#!#0#!#1#!#0#!#0#!#0
255#!#0#!#1#!#0#!#0#!#0
256#!#1#!#0#!#0#!#0#!#0
258#!#0#!#0#!#0#!#0#!#0
259#!#0#!#1#!#0#!#1#!#0
260#!#0#!#0#!#0#!#0#!#0
261#!#0#!#0#!#0#!#0#!#0
262#!#0#!#1#!#0#!#0#!#0
264#!#1#!#1#!#0#!#0#!#0
265#!#0#!#0#!#0#!#0#!#0
266#!#0#!#0#!#1#!#0#!#0
267#!#2#!#0#!#0#!#0#!#0
269#!#1#!#2#!#0#!#0#!#0
270#!#0#!#0#!#0#!#0#!#1
271#!#0#!#1#!#0#!#0#!#0
272#!#0#!#0#!#0#!#0#!#0
274#!#0#!#0#!#0#!#0#!#0
275#!#0#!#0#!#0#!#0#!#0
276#!#0#!#0#!#0#!#0#!#0
277#!#0#!#0#!#1#!#1#!#0
278#!#0#!#0#!#0#!#0#!#0
279#!#0#!#0#!#0#!#0#!#0
280#!#0#!#0#!#1#!#0#!#0
282#!#0#!#0#!#0#!#0#!#0
283#!#0#!#0#!#0#!#0#!#0
284#!#0#!#0#!#0#!#0#!#0
285#!#0#!#0#!#0#!#1#!#0
286#!#0#!#0#!#0#!#0#!#0
287#!#0#!#0#!#0#!#1#!#0
288#!#1#!#0#!#0#!#2#!#0
289#!#0#!#0#!#0#!#0#!#1
290#!#0#!#0#!#0#!#0#!#0
291#!#0#!#1#!#0#!#0#!#1
292#!#1#!#0#!#1#!#0#!#0
293#!#0#!#0#!#0#!#0#!#0
294#!#0#!#0#!#0#!#0#!#0
296#!#1#!#0#!#0#!#0#!#0
297#!#0#!#0#!#0#!#1#!#0
298#!#0#!#1#!#0#!#0#!#0
299#!#0#!#0#!#0#!#0#!#0
300#!#0#!#0#!#0#!#0#!#1
~~END~~


-- 3+ column IN src table pivot
SELECT ManufactureID, EmployeeID, [2] AS STORE2, [3] AS STORE3, [4] AS STORE4, [5] AS STORE5, [6] AS STORE6
FROM
(
    SELECT ManufactureID, EmployeeID, ItemID, StoreID
    FROM StoreReceipt
)AS srctable
PIVOT (
    COUNT (ItemID)
    FOR StoreID IN ([2], [3], [4], [5], [6])
) AS pvt
GO
~~START~~
int#!#int#!#int#!#int#!#int#!#int#!#int
1200#!#200#!#0#!#0#!#0#!#0#!#0
1200#!#203#!#0#!#0#!#0#!#1#!#0
1200#!#220#!#0#!#0#!#0#!#0#!#0
1200#!#222#!#0#!#0#!#0#!#1#!#0
1200#!#259#!#0#!#0#!#0#!#0#!#0
1200#!#264#!#0#!#1#!#0#!#0#!#0
1200#!#266#!#0#!#0#!#1#!#0#!#0
1200#!#269#!#1#!#0#!#0#!#0#!#0
1201#!#213#!#0#!#0#!#1#!#0#!#0
1201#!#229#!#0#!#0#!#1#!#0#!#0
1201#!#232#!#0#!#0#!#0#!#0#!#0
1201#!#267#!#0#!#0#!#0#!#0#!#0
1202#!#228#!#0#!#0#!#0#!#0#!#0
1202#!#246#!#0#!#0#!#0#!#0#!#0
1202#!#272#!#0#!#0#!#0#!#0#!#0
1202#!#287#!#0#!#0#!#0#!#0#!#0
1202#!#288#!#1#!#0#!#0#!#1#!#0
1203#!#214#!#0#!#0#!#0#!#0#!#0
1203#!#220#!#0#!#0#!#0#!#1#!#0
1203#!#249#!#0#!#0#!#0#!#0#!#0
1203#!#262#!#0#!#0#!#0#!#0#!#0
1204#!#224#!#0#!#0#!#0#!#0#!#1
1204#!#232#!#0#!#0#!#0#!#0#!#0
1204#!#267#!#0#!#0#!#0#!#0#!#0
1204#!#282#!#0#!#0#!#0#!#0#!#0
1204#!#299#!#0#!#0#!#0#!#0#!#0
1205#!#201#!#0#!#0#!#0#!#0#!#0
1205#!#234#!#0#!#0#!#0#!#0#!#1
1206#!#227#!#0#!#0#!#0#!#0#!#0
1206#!#248#!#0#!#0#!#1#!#0#!#0
1206#!#289#!#0#!#0#!#0#!#0#!#1
1207#!#218#!#0#!#0#!#1#!#0#!#0
1207#!#250#!#0#!#0#!#0#!#0#!#1
1207#!#279#!#0#!#0#!#0#!#0#!#0
1208#!#203#!#0#!#0#!#0#!#0#!#0
1208#!#217#!#0#!#0#!#0#!#1#!#0
1208#!#223#!#0#!#0#!#0#!#1#!#0
1208#!#238#!#0#!#0#!#1#!#0#!#0
1208#!#270#!#0#!#0#!#0#!#0#!#0
1209#!#252#!#0#!#0#!#0#!#0#!#0
1209#!#267#!#1#!#0#!#0#!#0#!#0
1210#!#267#!#1#!#0#!#0#!#0#!#0
1210#!#298#!#0#!#1#!#0#!#0#!#0
1211#!#212#!#0#!#0#!#1#!#0#!#0
1211#!#218#!#0#!#0#!#0#!#0#!#0
1211#!#219#!#1#!#0#!#0#!#0#!#0
1211#!#243#!#0#!#0#!#0#!#0#!#0
1212#!#204#!#0#!#1#!#0#!#0#!#0
1212#!#247#!#1#!#0#!#0#!#0#!#0
1212#!#250#!#0#!#0#!#0#!#0#!#1
1212#!#253#!#1#!#0#!#0#!#0#!#0
1213#!#276#!#0#!#0#!#0#!#0#!#0
1213#!#288#!#0#!#0#!#0#!#0#!#0
1213#!#294#!#0#!#0#!#0#!#0#!#0
1214#!#211#!#0#!#0#!#0#!#0#!#0
1214#!#236#!#0#!#0#!#1#!#0#!#0
1214#!#278#!#0#!#0#!#0#!#0#!#0
1214#!#289#!#0#!#0#!#0#!#0#!#0
1214#!#291#!#0#!#0#!#0#!#0#!#1
1214#!#292#!#0#!#0#!#1#!#0#!#0
1214#!#296#!#0#!#0#!#0#!#0#!#0
1215#!#211#!#1#!#0#!#0#!#0#!#0
1215#!#239#!#0#!#0#!#0#!#0#!#0
1215#!#249#!#1#!#0#!#0#!#0#!#0
1215#!#265#!#0#!#0#!#0#!#0#!#0
1215#!#278#!#0#!#0#!#0#!#0#!#0
1215#!#283#!#0#!#0#!#0#!#0#!#0
1215#!#294#!#0#!#0#!#0#!#0#!#0
1216#!#227#!#0#!#0#!#0#!#0#!#0
1217#!#230#!#0#!#1#!#0#!#0#!#0
1217#!#264#!#0#!#0#!#0#!#0#!#0
1217#!#269#!#0#!#1#!#0#!#0#!#0
1217#!#292#!#0#!#0#!#0#!#0#!#0
1218#!#201#!#0#!#0#!#0#!#0#!#0
1218#!#203#!#0#!#0#!#0#!#0#!#0
1218#!#214#!#0#!#0#!#0#!#0#!#0
1218#!#226#!#0#!#0#!#0#!#0#!#0
1218#!#235#!#0#!#0#!#0#!#0#!#0
1218#!#240#!#0#!#0#!#0#!#0#!#0
1218#!#247#!#0#!#0#!#0#!#0#!#0
1218#!#253#!#0#!#0#!#0#!#0#!#0
1218#!#254#!#0#!#1#!#0#!#0#!#0
1219#!#221#!#0#!#0#!#0#!#0#!#0
1219#!#227#!#0#!#0#!#0#!#0#!#0
1220#!#234#!#0#!#0#!#0#!#0#!#0
1220#!#285#!#0#!#0#!#0#!#0#!#0
1220#!#288#!#0#!#0#!#0#!#1#!#0
1221#!#204#!#0#!#0#!#0#!#0#!#1
1221#!#215#!#0#!#0#!#0#!#0#!#0
1221#!#223#!#0#!#0#!#0#!#1#!#0
1221#!#225#!#0#!#0#!#0#!#1#!#0
1221#!#274#!#0#!#0#!#0#!#0#!#0
1222#!#231#!#0#!#0#!#0#!#0#!#0
1223#!#208#!#0#!#0#!#0#!#0#!#0
1223#!#258#!#0#!#0#!#0#!#0#!#0
1223#!#293#!#0#!#0#!#0#!#0#!#0
1224#!#210#!#0#!#0#!#0#!#0#!#0
1224#!#253#!#0#!#0#!#0#!#0#!#0
1225#!#224#!#0#!#0#!#0#!#0#!#0
1225#!#278#!#0#!#0#!#0#!#0#!#0
1226#!#200#!#0#!#0#!#1#!#0#!#0
1226#!#202#!#1#!#0#!#0#!#0#!#0
1226#!#214#!#0#!#1#!#0#!#0#!#0
1226#!#251#!#1#!#0#!#0#!#0#!#0
1226#!#292#!#1#!#0#!#0#!#0#!#0
1227#!#209#!#0#!#0#!#0#!#0#!#0
1227#!#269#!#0#!#1#!#0#!#0#!#0
1228#!#247#!#0#!#0#!#0#!#0#!#0
1228#!#248#!#0#!#0#!#1#!#0#!#0
1229#!#200#!#0#!#0#!#1#!#0#!#0
1229#!#224#!#0#!#0#!#0#!#0#!#0
1229#!#225#!#0#!#1#!#0#!#0#!#0
1229#!#229#!#0#!#0#!#0#!#0#!#0
1229#!#243#!#0#!#0#!#0#!#0#!#0
1229#!#270#!#0#!#0#!#0#!#0#!#1
1229#!#276#!#0#!#0#!#0#!#0#!#0
1231#!#227#!#0#!#0#!#0#!#0#!#1
1231#!#228#!#0#!#1#!#0#!#0#!#0
1231#!#256#!#1#!#0#!#0#!#0#!#0
1231#!#296#!#0#!#0#!#0#!#0#!#0
1232#!#211#!#0#!#0#!#0#!#0#!#0
1232#!#229#!#0#!#0#!#0#!#0#!#0
1233#!#221#!#0#!#0#!#0#!#0#!#0
1233#!#254#!#0#!#0#!#0#!#0#!#0
1233#!#275#!#0#!#0#!#0#!#0#!#0
1234#!#222#!#0#!#0#!#1#!#0#!#0
1234#!#230#!#0#!#0#!#0#!#0#!#0
1234#!#296#!#0#!#0#!#0#!#0#!#0
1235#!#217#!#0#!#0#!#0#!#0#!#0
1235#!#255#!#0#!#0#!#0#!#0#!#0
1235#!#285#!#0#!#0#!#0#!#1#!#0
1236#!#211#!#1#!#0#!#0#!#0#!#0
1236#!#235#!#0#!#0#!#0#!#0#!#0
1236#!#262#!#0#!#1#!#0#!#0#!#0
1236#!#286#!#0#!#0#!#0#!#0#!#0
1237#!#241#!#0#!#0#!#0#!#0#!#0
1237#!#251#!#0#!#1#!#0#!#0#!#0
1237#!#290#!#0#!#0#!#0#!#0#!#0
1237#!#291#!#0#!#1#!#0#!#0#!#0
1238#!#209#!#0#!#1#!#0#!#0#!#0
1238#!#219#!#0#!#0#!#0#!#0#!#1
1238#!#234#!#0#!#0#!#0#!#0#!#0
1238#!#264#!#1#!#0#!#0#!#0#!#0
1238#!#279#!#0#!#0#!#0#!#0#!#0
1238#!#300#!#0#!#0#!#0#!#0#!#1
1239#!#208#!#0#!#1#!#0#!#0#!#0
1239#!#255#!#0#!#0#!#0#!#0#!#0
1239#!#259#!#0#!#0#!#0#!#1#!#0
1239#!#269#!#0#!#0#!#0#!#0#!#0
1239#!#271#!#0#!#1#!#0#!#0#!#0
1239#!#277#!#0#!#0#!#0#!#0#!#0
1240#!#201#!#0#!#0#!#0#!#0#!#0
1240#!#204#!#0#!#0#!#0#!#0#!#0
1240#!#251#!#0#!#0#!#0#!#0#!#0
1240#!#277#!#0#!#0#!#1#!#0#!#0
1240#!#296#!#1#!#0#!#0#!#0#!#0
1241#!#243#!#0#!#0#!#0#!#0#!#0
1241#!#277#!#0#!#0#!#0#!#1#!#0
1241#!#299#!#0#!#0#!#0#!#0#!#0
1242#!#210#!#0#!#0#!#0#!#0#!#0
1242#!#213#!#0#!#0#!#0#!#0#!#0
1242#!#249#!#0#!#0#!#0#!#0#!#0
1242#!#280#!#0#!#0#!#1#!#0#!#0
1242#!#283#!#0#!#0#!#0#!#0#!#0
1242#!#290#!#0#!#0#!#0#!#0#!#0
1243#!#213#!#0#!#0#!#0#!#0#!#0
1243#!#226#!#1#!#0#!#0#!#0#!#0
1243#!#227#!#0#!#0#!#0#!#0#!#0
1243#!#232#!#0#!#0#!#0#!#0#!#0
1243#!#245#!#0#!#0#!#0#!#0#!#0
1243#!#289#!#0#!#0#!#0#!#0#!#0
1244#!#248#!#0#!#0#!#0#!#0#!#0
1244#!#250#!#0#!#0#!#0#!#0#!#0
1245#!#230#!#1#!#0#!#0#!#0#!#0
1245#!#237#!#1#!#0#!#0#!#0#!#0
1245#!#251#!#0#!#0#!#1#!#0#!#0
1245#!#260#!#0#!#0#!#0#!#0#!#0
1245#!#289#!#0#!#0#!#0#!#0#!#0
1245#!#292#!#0#!#0#!#0#!#0#!#0
1246#!#216#!#0#!#1#!#0#!#0#!#0
1246#!#259#!#0#!#1#!#0#!#0#!#0
1246#!#271#!#0#!#0#!#0#!#0#!#0
1246#!#279#!#0#!#0#!#0#!#0#!#0
1246#!#286#!#0#!#0#!#0#!#0#!#0
1246#!#296#!#0#!#0#!#0#!#0#!#0
1247#!#207#!#0#!#0#!#0#!#0#!#0
1247#!#231#!#0#!#0#!#0#!#0#!#0
1247#!#255#!#0#!#1#!#0#!#0#!#0
1247#!#284#!#0#!#0#!#0#!#0#!#0
1248#!#297#!#0#!#0#!#0#!#1#!#0
1249#!#256#!#0#!#0#!#0#!#0#!#0
1249#!#261#!#0#!#0#!#0#!#0#!#0
1250#!#203#!#0#!#0#!#0#!#0#!#0
1250#!#205#!#0#!#0#!#0#!#0#!#1
1250#!#229#!#0#!#0#!#0#!#0#!#0
1250#!#232#!#0#!#0#!#0#!#0#!#1
1250#!#287#!#0#!#0#!#0#!#1#!#0
~~END~~


-- ORDER by test
SELECT  ManufactureID, EmployeeID, [2] AS STORE2, [3] AS STORE3, [4] AS STORE4, [5] AS STORE5, [6] AS STORE6
FROM
(
    SELECT ManufactureID, EmployeeID, ItemID, StoreID
    FROM StoreReceipt
)AS srctable
PIVOT (
    COUNT (ItemID)
    FOR StoreID IN ([2], [3], [4], [5], [6])
) AS pvt
ORDER by EmployeeID
GO
~~START~~
int#!#int#!#int#!#int#!#int#!#int#!#int
1226#!#200#!#0#!#0#!#1#!#0#!#0
1229#!#200#!#0#!#0#!#1#!#0#!#0
1200#!#200#!#0#!#0#!#0#!#0#!#0
1218#!#201#!#0#!#0#!#0#!#0#!#0
1240#!#201#!#0#!#0#!#0#!#0#!#0
1205#!#201#!#0#!#0#!#0#!#0#!#0
1226#!#202#!#1#!#0#!#0#!#0#!#0
1200#!#203#!#0#!#0#!#0#!#1#!#0
1250#!#203#!#0#!#0#!#0#!#0#!#0
1208#!#203#!#0#!#0#!#0#!#0#!#0
1218#!#203#!#0#!#0#!#0#!#0#!#0
1212#!#204#!#0#!#1#!#0#!#0#!#0
1221#!#204#!#0#!#0#!#0#!#0#!#1
1240#!#204#!#0#!#0#!#0#!#0#!#0
1250#!#205#!#0#!#0#!#0#!#0#!#1
1247#!#207#!#0#!#0#!#0#!#0#!#0
1239#!#208#!#0#!#1#!#0#!#0#!#0
1223#!#208#!#0#!#0#!#0#!#0#!#0
1227#!#209#!#0#!#0#!#0#!#0#!#0
1238#!#209#!#0#!#1#!#0#!#0#!#0
1224#!#210#!#0#!#0#!#0#!#0#!#0
1242#!#210#!#0#!#0#!#0#!#0#!#0
1214#!#211#!#0#!#0#!#0#!#0#!#0
1236#!#211#!#1#!#0#!#0#!#0#!#0
1215#!#211#!#1#!#0#!#0#!#0#!#0
1232#!#211#!#0#!#0#!#0#!#0#!#0
1211#!#212#!#0#!#0#!#1#!#0#!#0
1243#!#213#!#0#!#0#!#0#!#0#!#0
1201#!#213#!#0#!#0#!#1#!#0#!#0
1242#!#213#!#0#!#0#!#0#!#0#!#0
1203#!#214#!#0#!#0#!#0#!#0#!#0
1226#!#214#!#0#!#1#!#0#!#0#!#0
1218#!#214#!#0#!#0#!#0#!#0#!#0
1221#!#215#!#0#!#0#!#0#!#0#!#0
1246#!#216#!#0#!#1#!#0#!#0#!#0
1235#!#217#!#0#!#0#!#0#!#0#!#0
1208#!#217#!#0#!#0#!#0#!#1#!#0
1211#!#218#!#0#!#0#!#0#!#0#!#0
1207#!#218#!#0#!#0#!#1#!#0#!#0
1238#!#219#!#0#!#0#!#0#!#0#!#1
1211#!#219#!#1#!#0#!#0#!#0#!#0
1203#!#220#!#0#!#0#!#0#!#1#!#0
1200#!#220#!#0#!#0#!#0#!#0#!#0
1233#!#221#!#0#!#0#!#0#!#0#!#0
1219#!#221#!#0#!#0#!#0#!#0#!#0
1234#!#222#!#0#!#0#!#1#!#0#!#0
1200#!#222#!#0#!#0#!#0#!#1#!#0
1208#!#223#!#0#!#0#!#0#!#1#!#0
1221#!#223#!#0#!#0#!#0#!#1#!#0
1225#!#224#!#0#!#0#!#0#!#0#!#0
1204#!#224#!#0#!#0#!#0#!#0#!#1
1229#!#224#!#0#!#0#!#0#!#0#!#0
1221#!#225#!#0#!#0#!#0#!#1#!#0
1229#!#225#!#0#!#1#!#0#!#0#!#0
1243#!#226#!#1#!#0#!#0#!#0#!#0
1218#!#226#!#0#!#0#!#0#!#0#!#0
1206#!#227#!#0#!#0#!#0#!#0#!#0
1216#!#227#!#0#!#0#!#0#!#0#!#0
1231#!#227#!#0#!#0#!#0#!#0#!#1
1243#!#227#!#0#!#0#!#0#!#0#!#0
1219#!#227#!#0#!#0#!#0#!#0#!#0
1202#!#228#!#0#!#0#!#0#!#0#!#0
1231#!#228#!#0#!#1#!#0#!#0#!#0
1229#!#229#!#0#!#0#!#0#!#0#!#0
1201#!#229#!#0#!#0#!#1#!#0#!#0
1250#!#229#!#0#!#0#!#0#!#0#!#0
1232#!#229#!#0#!#0#!#0#!#0#!#0
1217#!#230#!#0#!#1#!#0#!#0#!#0
1234#!#230#!#0#!#0#!#0#!#0#!#0
1245#!#230#!#1#!#0#!#0#!#0#!#0
1247#!#231#!#0#!#0#!#0#!#0#!#0
1222#!#231#!#0#!#0#!#0#!#0#!#0
1204#!#232#!#0#!#0#!#0#!#0#!#0
1243#!#232#!#0#!#0#!#0#!#0#!#0
1201#!#232#!#0#!#0#!#0#!#0#!#0
1250#!#232#!#0#!#0#!#0#!#0#!#1
1220#!#234#!#0#!#0#!#0#!#0#!#0
1238#!#234#!#0#!#0#!#0#!#0#!#0
1205#!#234#!#0#!#0#!#0#!#0#!#1
1236#!#235#!#0#!#0#!#0#!#0#!#0
1218#!#235#!#0#!#0#!#0#!#0#!#0
1214#!#236#!#0#!#0#!#1#!#0#!#0
1245#!#237#!#1#!#0#!#0#!#0#!#0
1208#!#238#!#0#!#0#!#1#!#0#!#0
1215#!#239#!#0#!#0#!#0#!#0#!#0
1218#!#240#!#0#!#0#!#0#!#0#!#0
1237#!#241#!#0#!#0#!#0#!#0#!#0
1211#!#243#!#0#!#0#!#0#!#0#!#0
1241#!#243#!#0#!#0#!#0#!#0#!#0
1229#!#243#!#0#!#0#!#0#!#0#!#0
1243#!#245#!#0#!#0#!#0#!#0#!#0
1202#!#246#!#0#!#0#!#0#!#0#!#0
1212#!#247#!#1#!#0#!#0#!#0#!#0
1218#!#247#!#0#!#0#!#0#!#0#!#0
1228#!#247#!#0#!#0#!#0#!#0#!#0
1228#!#248#!#0#!#0#!#1#!#0#!#0
1244#!#248#!#0#!#0#!#0#!#0#!#0
1206#!#248#!#0#!#0#!#1#!#0#!#0
1215#!#249#!#1#!#0#!#0#!#0#!#0
1242#!#249#!#0#!#0#!#0#!#0#!#0
1203#!#249#!#0#!#0#!#0#!#0#!#0
1212#!#250#!#0#!#0#!#0#!#0#!#1
1244#!#250#!#0#!#0#!#0#!#0#!#0
1207#!#250#!#0#!#0#!#0#!#0#!#1
1240#!#251#!#0#!#0#!#0#!#0#!#0
1226#!#251#!#1#!#0#!#0#!#0#!#0
1245#!#251#!#0#!#0#!#1#!#0#!#0
1237#!#251#!#0#!#1#!#0#!#0#!#0
1209#!#252#!#0#!#0#!#0#!#0#!#0
1218#!#253#!#0#!#0#!#0#!#0#!#0
1212#!#253#!#1#!#0#!#0#!#0#!#0
1224#!#253#!#0#!#0#!#0#!#0#!#0
1233#!#254#!#0#!#0#!#0#!#0#!#0
1218#!#254#!#0#!#1#!#0#!#0#!#0
1247#!#255#!#0#!#1#!#0#!#0#!#0
1235#!#255#!#0#!#0#!#0#!#0#!#0
1239#!#255#!#0#!#0#!#0#!#0#!#0
1249#!#256#!#0#!#0#!#0#!#0#!#0
1231#!#256#!#1#!#0#!#0#!#0#!#0
1223#!#258#!#0#!#0#!#0#!#0#!#0
1246#!#259#!#0#!#1#!#0#!#0#!#0
1200#!#259#!#0#!#0#!#0#!#0#!#0
1239#!#259#!#0#!#0#!#0#!#1#!#0
1245#!#260#!#0#!#0#!#0#!#0#!#0
1249#!#261#!#0#!#0#!#0#!#0#!#0
1203#!#262#!#0#!#0#!#0#!#0#!#0
1236#!#262#!#0#!#1#!#0#!#0#!#0
1200#!#264#!#0#!#1#!#0#!#0#!#0
1238#!#264#!#1#!#0#!#0#!#0#!#0
1217#!#264#!#0#!#0#!#0#!#0#!#0
1215#!#265#!#0#!#0#!#0#!#0#!#0
1200#!#266#!#0#!#0#!#1#!#0#!#0
1210#!#267#!#1#!#0#!#0#!#0#!#0
1201#!#267#!#0#!#0#!#0#!#0#!#0
1209#!#267#!#1#!#0#!#0#!#0#!#0
1204#!#267#!#0#!#0#!#0#!#0#!#0
1239#!#269#!#0#!#0#!#0#!#0#!#0
1200#!#269#!#1#!#0#!#0#!#0#!#0
1217#!#269#!#0#!#1#!#0#!#0#!#0
1227#!#269#!#0#!#1#!#0#!#0#!#0
1208#!#270#!#0#!#0#!#0#!#0#!#0
1229#!#270#!#0#!#0#!#0#!#0#!#1
1246#!#271#!#0#!#0#!#0#!#0#!#0
1239#!#271#!#0#!#1#!#0#!#0#!#0
1202#!#272#!#0#!#0#!#0#!#0#!#0
1221#!#274#!#0#!#0#!#0#!#0#!#0
1233#!#275#!#0#!#0#!#0#!#0#!#0
1229#!#276#!#0#!#0#!#0#!#0#!#0
1213#!#276#!#0#!#0#!#0#!#0#!#0
1240#!#277#!#0#!#0#!#1#!#0#!#0
1239#!#277#!#0#!#0#!#0#!#0#!#0
1241#!#277#!#0#!#0#!#0#!#1#!#0
1225#!#278#!#0#!#0#!#0#!#0#!#0
1215#!#278#!#0#!#0#!#0#!#0#!#0
1214#!#278#!#0#!#0#!#0#!#0#!#0
1207#!#279#!#0#!#0#!#0#!#0#!#0
1246#!#279#!#0#!#0#!#0#!#0#!#0
1238#!#279#!#0#!#0#!#0#!#0#!#0
1242#!#280#!#0#!#0#!#1#!#0#!#0
1204#!#282#!#0#!#0#!#0#!#0#!#0
1242#!#283#!#0#!#0#!#0#!#0#!#0
1215#!#283#!#0#!#0#!#0#!#0#!#0
1247#!#284#!#0#!#0#!#0#!#0#!#0
1220#!#285#!#0#!#0#!#0#!#0#!#0
1235#!#285#!#0#!#0#!#0#!#1#!#0
1236#!#286#!#0#!#0#!#0#!#0#!#0
1246#!#286#!#0#!#0#!#0#!#0#!#0
1250#!#287#!#0#!#0#!#0#!#1#!#0
1202#!#287#!#0#!#0#!#0#!#0#!#0
1202#!#288#!#1#!#0#!#0#!#1#!#0
1220#!#288#!#0#!#0#!#0#!#1#!#0
1213#!#288#!#0#!#0#!#0#!#0#!#0
1245#!#289#!#0#!#0#!#0#!#0#!#0
1206#!#289#!#0#!#0#!#0#!#0#!#1
1243#!#289#!#0#!#0#!#0#!#0#!#0
1214#!#289#!#0#!#0#!#0#!#0#!#0
1237#!#290#!#0#!#0#!#0#!#0#!#0
1242#!#290#!#0#!#0#!#0#!#0#!#0
1214#!#291#!#0#!#0#!#0#!#0#!#1
1237#!#291#!#0#!#1#!#0#!#0#!#0
1245#!#292#!#0#!#0#!#0#!#0#!#0
1226#!#292#!#1#!#0#!#0#!#0#!#0
1217#!#292#!#0#!#0#!#0#!#0#!#0
1214#!#292#!#0#!#0#!#1#!#0#!#0
1223#!#293#!#0#!#0#!#0#!#0#!#0
1213#!#294#!#0#!#0#!#0#!#0#!#0
1215#!#294#!#0#!#0#!#0#!#0#!#0
1246#!#296#!#0#!#0#!#0#!#0#!#0
1214#!#296#!#0#!#0#!#0#!#0#!#0
1231#!#296#!#0#!#0#!#0#!#0#!#0
1240#!#296#!#1#!#0#!#0#!#0#!#0
1234#!#296#!#0#!#0#!#0#!#0#!#0
1248#!#297#!#0#!#0#!#0#!#1#!#0
1210#!#298#!#0#!#1#!#0#!#0#!#0
1204#!#299#!#0#!#0#!#0#!#0#!#0
1241#!#299#!#0#!#0#!#0#!#0#!#0
1238#!#300#!#0#!#0#!#0#!#0#!#1
~~END~~


-- whereclause test
SELECT  ManufactureID, [2] AS STORE2, [3] AS STORE3, [4] AS STORE4, [5] AS STORE5, [6] AS STORE6
FROM
(
    SELECT ManufactureID, ItemID, StoreID
    FROM StoreReceipt
)AS srctable
PIVOT (
    COUNT (ItemID)
    FOR StoreID IN ([2], [3], [4], [5], [6])
) AS pvt
WHERE ManufactureID < 1220
GO
~~START~~
int#!#int#!#int#!#int#!#int#!#int
1200#!#1#!#1#!#1#!#2#!#0
1201#!#0#!#0#!#2#!#0#!#0
1202#!#1#!#0#!#0#!#1#!#0
1203#!#0#!#0#!#0#!#1#!#0
1204#!#0#!#0#!#0#!#0#!#1
1205#!#0#!#0#!#0#!#0#!#1
1206#!#0#!#0#!#1#!#0#!#1
1207#!#0#!#0#!#1#!#0#!#1
1208#!#0#!#0#!#1#!#2#!#0
1209#!#1#!#0#!#0#!#0#!#0
1210#!#1#!#1#!#0#!#0#!#0
1211#!#1#!#0#!#1#!#0#!#0
1212#!#2#!#1#!#0#!#0#!#1
1213#!#0#!#0#!#0#!#0#!#0
1214#!#0#!#0#!#2#!#0#!#1
1215#!#2#!#0#!#0#!#0#!#0
1216#!#0#!#0#!#0#!#0#!#0
1217#!#0#!#2#!#0#!#0#!#0
1218#!#0#!#1#!#0#!#0#!#0
1219#!#0#!#0#!#0#!#0#!#0
~~END~~


-- groupby, having clause test
SELECT EmployeeID, ManufactureID, [2] AS STORE2
FROM
(
    SELECT EmployeeID, ManufactureID, ItemID, StoreID
    FROM StoreReceipt
)AS srctable
PIVOT (
    COUNT (ItemID)
    FOR StoreID IN ([2], [3], [4], [5], [6])
) AS pvt
WHERE EmployeeID < 210
group by EmployeeID, ManufactureID, [2]
having ManufactureID < 1250
ORDER by 1,2
GO
~~START~~
int#!#int#!#int
200#!#1200#!#0
200#!#1226#!#0
200#!#1229#!#0
201#!#1205#!#0
201#!#1218#!#0
201#!#1240#!#0
202#!#1226#!#1
203#!#1200#!#0
203#!#1208#!#0
203#!#1218#!#0
204#!#1212#!#0
204#!#1221#!#0
204#!#1240#!#0
207#!#1247#!#0
208#!#1223#!#0
208#!#1239#!#0
209#!#1227#!#0
209#!#1238#!#0
~~END~~



-- TOP test
SELECT TOP 5 ManufactureID, [2] AS STORE2, [3] AS STORE3, [4] AS STORE4, [5] AS STORE5, [6] AS STORE6
FROM
(
    SELECT ManufactureID, ItemID, StoreID
    FROM StoreReceipt
)AS srctable
PIVOT (
    COUNT (ItemID)
    FOR StoreID IN ([2], [3], [4], [5], [6])
) AS pvt
GO
~~START~~
int#!#int#!#int#!#int#!#int#!#int
1200#!#1#!#1#!#1#!#2#!#0
1201#!#0#!#0#!#2#!#0#!#0
1202#!#1#!#0#!#0#!#1#!#0
1203#!#0#!#0#!#0#!#1#!#0
1204#!#0#!#0#!#0#!#0#!#1
~~END~~


-- distinct test 
SELECT distinct ManufactureID, [2] AS STORE2, [3] AS STORE3, [4] AS STORE4, [5] AS STORE5, [6] AS STORE6
FROM
(
    SELECT ManufactureID, ItemID, StoreID
    FROM StoreReceipt
)AS srctable
PIVOT (
    COUNT (ItemID)
    FOR StoreID IN ([2], [3], [4], [5], [6])
) AS pvt
GO
~~START~~
int#!#int#!#int#!#int#!#int#!#int
1200#!#1#!#1#!#1#!#2#!#0
1201#!#0#!#0#!#2#!#0#!#0
1202#!#1#!#0#!#0#!#1#!#0
1203#!#0#!#0#!#0#!#1#!#0
1204#!#0#!#0#!#0#!#0#!#1
1205#!#0#!#0#!#0#!#0#!#1
1206#!#0#!#0#!#1#!#0#!#1
1207#!#0#!#0#!#1#!#0#!#1
1208#!#0#!#0#!#1#!#2#!#0
1209#!#1#!#0#!#0#!#0#!#0
1210#!#1#!#1#!#0#!#0#!#0
1211#!#1#!#0#!#1#!#0#!#0
1212#!#2#!#1#!#0#!#0#!#1
1213#!#0#!#0#!#0#!#0#!#0
1214#!#0#!#0#!#2#!#0#!#1
1215#!#2#!#0#!#0#!#0#!#0
1216#!#0#!#0#!#0#!#0#!#0
1217#!#0#!#2#!#0#!#0#!#0
1218#!#0#!#1#!#0#!#0#!#0
1219#!#0#!#0#!#0#!#0#!#0
1220#!#0#!#0#!#0#!#1#!#0
1221#!#0#!#0#!#0#!#2#!#1
1222#!#0#!#0#!#0#!#0#!#0
1223#!#0#!#0#!#0#!#0#!#0
1224#!#0#!#0#!#0#!#0#!#0
1225#!#0#!#0#!#0#!#0#!#0
1226#!#3#!#1#!#1#!#0#!#0
1227#!#0#!#1#!#0#!#0#!#0
1228#!#0#!#0#!#1#!#0#!#0
1229#!#0#!#1#!#1#!#0#!#1
1231#!#1#!#1#!#0#!#0#!#1
1232#!#0#!#0#!#0#!#0#!#0
1233#!#0#!#0#!#0#!#0#!#0
1234#!#0#!#0#!#1#!#0#!#0
1235#!#0#!#0#!#0#!#1#!#0
1236#!#1#!#1#!#0#!#0#!#0
1237#!#0#!#2#!#0#!#0#!#0
1238#!#1#!#1#!#0#!#0#!#2
1239#!#0#!#2#!#0#!#1#!#0
1240#!#1#!#0#!#1#!#0#!#0
1241#!#0#!#0#!#0#!#1#!#0
1242#!#0#!#0#!#1#!#0#!#0
1243#!#1#!#0#!#0#!#0#!#0
1244#!#0#!#0#!#0#!#0#!#0
1245#!#2#!#0#!#1#!#0#!#0
1246#!#0#!#2#!#0#!#0#!#0
1247#!#0#!#1#!#0#!#0#!#0
1248#!#0#!#0#!#0#!#1#!#0
1249#!#0#!#0#!#0#!#0#!#0
1250#!#0#!#0#!#0#!#1#!#2
~~END~~



-- INSERT INTO test
INSERT INTO pivot_insert_into
SELECT  ManufactureID, EmployeeID, [2] AS STORE2, [3] AS STORE3, [4] AS STORE4, [5] AS STORE5, [6] AS STORE6
FROM
(
    SELECT ManufactureID, EmployeeID, ItemID, StoreID
    FROM StoreReceipt
)AS srctable
PIVOT (
    COUNT (ItemID)
    FOR StoreID IN ([2], [3], [4], [5], [6])
) AS pvt;
SELECT TOP 10 * FROM pivot_insert_into ORDER by 1, 2;
GO
~~ROW COUNT: 197~~

~~START~~
int#!#int#!#int#!#int#!#int#!#int#!#int
1200#!#200#!#0#!#0#!#0#!#0#!#0
1200#!#203#!#0#!#0#!#0#!#1#!#0
1200#!#220#!#0#!#0#!#0#!#0#!#0
1200#!#222#!#0#!#0#!#0#!#1#!#0
1200#!#259#!#0#!#0#!#0#!#0#!#0
1200#!#264#!#0#!#1#!#0#!#0#!#0
1200#!#266#!#0#!#0#!#1#!#0#!#0
1200#!#269#!#1#!#0#!#0#!#0#!#0
1201#!#213#!#0#!#0#!#1#!#0#!#0
1201#!#229#!#0#!#0#!#1#!#0#!#0
~~END~~



-- SELECT INTO test
SELECT ManufactureID, EmployeeID, [2] AS STORE2, [3] AS STORE3, [4] AS STORE4, [5] AS STORE5, [6] AS STORE6
INTO pivot_SELECT_into
FROM
(
    SELECT ManufactureID, EmployeeID, ItemID, StoreID
    FROM StoreReceipt
)AS srctable
PIVOT (
    COUNT (ItemID)
    FOR StoreID IN ([2], [3], [4], [5], [6])
) AS pvt;
SELECT TOP 10 * FROM pivot_SELECT_into ORDER by 1, 2;
GO
~~START~~
int#!#int#!#int#!#int#!#int#!#int#!#int
1200#!#200#!#0#!#0#!#0#!#0#!#0
1200#!#203#!#0#!#0#!#0#!#1#!#0
1200#!#220#!#0#!#0#!#0#!#0#!#0
1200#!#222#!#0#!#0#!#0#!#1#!#0
1200#!#259#!#0#!#0#!#0#!#0#!#0
1200#!#264#!#0#!#1#!#0#!#0#!#0
1200#!#266#!#0#!#0#!#1#!#0#!#0
1200#!#269#!#1#!#0#!#0#!#0#!#0
1201#!#213#!#0#!#0#!#1#!#0#!#0
1201#!#229#!#0#!#0#!#1#!#0#!#0
~~END~~


-- union test
SELECT TOP 5 EmployeeID, [2] AS STORE2, [3] AS STORE3, [4] AS STORE4, [5] AS STORE5, [6] AS STORE6
FROM
(
    SELECT EmployeeID, ItemID, StoreID
    FROM StoreReceipt
)AS srctable
PIVOT (
    COUNT (ItemID)
    FOR StoreID IN ([2], [3], [4], [5], [6])
) AS pvt
UNION
SELECT TOP 5 ManufactureID, [2] AS STORE2, [3] AS STORE3, [4] AS STORE4, [5] AS STORE5, [6] AS STORE6
FROM
(
    SELECT ManufactureID, ItemID, StoreID
    FROM StoreReceipt
)AS srctable
PIVOT (
    COUNT (ItemID)
    FOR StoreID IN ([2], [3], [4], [5], [6])
) AS pvt2
ORDER by 1
GO
~~START~~
int#!#int#!#int#!#int#!#int#!#int
200#!#0#!#0#!#2#!#0#!#0
201#!#0#!#0#!#0#!#0#!#0
202#!#1#!#0#!#0#!#0#!#0
203#!#0#!#0#!#0#!#1#!#0
204#!#0#!#1#!#0#!#0#!#1
1200#!#1#!#1#!#1#!#2#!#0
1201#!#0#!#0#!#2#!#0#!#0
1202#!#1#!#0#!#0#!#1#!#0
1203#!#0#!#0#!#0#!#1#!#0
1204#!#0#!#0#!#0#!#0#!#1
~~END~~


-- sub query test
SELECT TOP 3 * FROM (
    SELECT ManufactureID, [2] AS STORE2, [3] AS STORE3, [4] AS STORE4, [5] AS STORE5, [6] AS STORE6
    FROM
    (
        SELECT ManufactureID, ItemID, StoreID
        FROM StoreReceipt
    )AS srctable
    PIVOT (
        COUNT (ItemID)
        FOR StoreID IN ([2], [3], [4], [5], [6])
    ) AS pvt2
) p
GO
~~START~~
int#!#int#!#int#!#int#!#int#!#int
1200#!#1#!#1#!#1#!#2#!#0
1201#!#0#!#0#!#2#!#0#!#0
1202#!#1#!#0#!#0#!#1#!#0
~~END~~


-- table variable test
DECLARE  @pivot_table_var TABLE (
	ManufactureID INT,
    ItemID INT,
	StoreID INT
);
INSERT INTO @pivot_table_var SELECT ManufactureID, ItemID, StoreID FROM StoreReceipt;
SELECT TOP 5 ManufactureID, [2] AS STORE2, [3] AS STORE3, [4] AS STORE4, [5] AS STORE5, [6] AS STORE6
FROM
    @pivot_table_var
PIVOT (
    COUNT (ItemID)
    FOR StoreID IN ([2], [3], [4], [5], [6])
) AS pvt2
GO
~~ROW COUNT: 200~~

~~START~~
int#!#int#!#int#!#int#!#int#!#int
1200#!#1#!#1#!#1#!#2#!#0
1201#!#0#!#0#!#2#!#0#!#0
1202#!#1#!#0#!#0#!#1#!#0
1203#!#0#!#0#!#0#!#1#!#0
1204#!#0#!#0#!#0#!#0#!#1
~~END~~


-- temp table test
SELECT ManufactureID, ItemID, StoreID INTO #pivot_temp_table FROM StoreReceipt;
SELECT TOP 5 ManufactureID, [2] AS STORE2, [3] AS STORE3, [4] AS STORE4, [5] AS STORE5, [6] AS STORE6
FROM
    #pivot_temp_table
PIVOT (
    COUNT (ItemID)
    FOR StoreID IN ([2], [3], [4], [5], [6])
) AS pvt2
GO
~~START~~
int#!#int#!#int#!#int#!#int#!#int
1200#!#1#!#1#!#1#!#2#!#0
1201#!#0#!#0#!#2#!#0#!#0
1202#!#1#!#0#!#0#!#1#!#0
1203#!#0#!#0#!#0#!#1#!#0
1204#!#0#!#0#!#0#!#0#!#1
~~END~~


-- procedure test
exec top_n_pivot 10
GO
~~START~~
int#!#int#!#int#!#int#!#int#!#int
1200#!#1#!#1#!#1#!#2#!#0
1201#!#0#!#0#!#2#!#0#!#0
1202#!#1#!#0#!#0#!#1#!#0
1203#!#0#!#0#!#0#!#1#!#0
1204#!#0#!#0#!#0#!#0#!#1
1205#!#0#!#0#!#0#!#0#!#1
1206#!#0#!#0#!#1#!#0#!#1
1207#!#0#!#0#!#1#!#0#!#1
1208#!#0#!#0#!#1#!#2#!#0
1209#!#1#!#0#!#0#!#0#!#0
~~END~~


exec top_n_pivot 5
GO
~~START~~
int#!#int#!#int#!#int#!#int#!#int
1200#!#1#!#1#!#1#!#2#!#0
1201#!#0#!#0#!#2#!#0#!#0
1202#!#1#!#0#!#0#!#1#!#0
1203#!#0#!#0#!#0#!#1#!#0
1204#!#0#!#0#!#0#!#0#!#1
~~END~~


-- function test
SELECT * FROM test_table_valued_function(12);
GO
~~START~~
int#!#int#!#int#!#int#!#int#!#int
1200#!#1#!#1#!#1#!#2#!#0
1201#!#0#!#0#!#2#!#0#!#0
1202#!#1#!#0#!#0#!#1#!#0
1203#!#0#!#0#!#0#!#1#!#0
1204#!#0#!#0#!#0#!#0#!#1
1205#!#0#!#0#!#0#!#0#!#1
1206#!#0#!#0#!#1#!#0#!#1
1207#!#0#!#0#!#1#!#0#!#1
1208#!#0#!#0#!#1#!#2#!#0
1209#!#1#!#0#!#0#!#0#!#0
1210#!#1#!#1#!#0#!#0#!#0
1211#!#1#!#0#!#1#!#0#!#0
~~END~~


SELECT * FROM test_table_valued_function(2);
GO
~~START~~
int#!#int#!#int#!#int#!#int#!#int
1200#!#1#!#1#!#1#!#2#!#0
1201#!#0#!#0#!#2#!#0#!#0
~~END~~


-- explain pivot
SET BABELFISH_SHOWPLAN_ALL ON;
SELECT TOP 5 ManufactureID, [2] AS STORE2, [3] AS STORE3, [4] AS STORE4, [5] AS STORE5, [6] AS STORE6
FROM
(
    SELECT ManufactureID, ItemID, StoreID
    FROM StoreReceipt
)AS srctable
PIVOT (
    COUNT (ItemID)
    FOR StoreID IN ([2], [3], [4], [5], [6])
) AS pvt
GO
~~START~~
text
Query Text: SELECT TOP 5 ManufactureID, [2] AS STORE2, [3] AS STORE3, [4] AS STORE4, [5] AS STORE5, [6] AS STORE6
FROM
(
    SELECT ManufactureID, ItemID, StoreID
    FROM StoreReceipt
)AS srctable
PIVOT (
    COUNT (ItemID)
    FOR StoreID IN ([2], [3], [4], [5], [6])
) AS pvt
Limit  (cost=0.00..0.05 rows=5 width=24)
  ->  Function Scan on bbf_pivot pvt  (cost=0.00..10.00 rows=1000 width=24)
~~END~~

SET BABELFISH_SHOWPLAN_ALL OFF;
GO


-- test column name with indirection (value column)
SELECT TOP 5 ManufactureID, [2] AS STORE2, [3] AS STORE3, [4] AS STORE4, [5] AS STORE5, [6] AS STORE6
FROM
(
    SELECT ManufactureID, ItemID, StoreID
    FROM StoreReceipt
)AS srctable
PIVOT (
    COUNT (srctable.ItemID)
    FOR StoreID IN ([2], [3], [4], [5], [6])
) AS pvt
GO
~~START~~
int#!#int#!#int#!#int#!#int#!#int
1200#!#0#!#0#!#0#!#1#!#0
1200#!#0#!#0#!#0#!#0#!#0
1200#!#0#!#0#!#0#!#0#!#0
1200#!#0#!#0#!#1#!#0#!#0
1200#!#0#!#0#!#0#!#0#!#0
~~END~~


-- test column name win indirection (category column)
SELECT TOP 5 ManufactureID, [2] AS STORE2, [3] AS STORE3, [4] AS STORE4, [5] AS STORE5, [6] AS STORE6
FROM
(
    SELECT ManufactureID, ItemID, StoreID
    FROM StoreReceipt
)AS srctable
PIVOT (
    COUNT (ItemID)
    FOR srctable.StoreID IN ([2], [3], [4], [5], [6])
) AS pvt
GO
~~START~~
int#!#int#!#int#!#int#!#int#!#int
1200#!#1#!#1#!#1#!#2#!#0
1201#!#0#!#0#!#2#!#0#!#0
1202#!#1#!#0#!#0#!#1#!#0
1203#!#0#!#0#!#0#!#1#!#0
1204#!#0#!#0#!#0#!#0#!#1
~~END~~


-- JOIN with PIVOT stmt is not currently supported
SELECT * FROM (SELECT TOP 5 ManufactureID, [2] AS STORE2, [3] AS STORE3
FROM
(
    SELECT ManufactureID, ItemID, StoreID
    FROM StoreReceipt
)AS srctable
PIVOT (
    COUNT (srctable.ItemID)
    FOR StoreID IN ([2], [3])
) AS pvt) AS p1
LEFT OUTER JOIN
(SELECT TOP 5 ManufactureID, [4] AS STORE2, [5] AS STORE3
FROM
(
    SELECT ManufactureID, ItemID, StoreID
    FROM StoreReceipt
)AS srctable
PIVOT (
    COUNT (srctable.ItemID)
    FOR StoreID IN ([4], [5])
) AS pvt2) AS p2
ON p1.ManufactureID = p2.ManufactureID
GO
~~ERROR (Code: 33557097)~~

~~ERROR (Message: JOIN with PIVOT statement is not currently supported)~~


-- Create VIEW ON PIVOT is not currently supported
CREATE VIEW pivot_view AS
SELECT TOP 5 ManufactureID, [2] AS STORE2, [3] AS STORE3, [4] AS STORE4, [5] AS STORE5, [6] AS STORE6
FROM
(
    SELECT ManufactureID, ItemID, StoreID
    FROM StoreReceipt
)AS srctable
PIVOT (
    COUNT (ItemID)
    FOR StoreID IN ([2], [3], [4], [5], [6])
) AS pvt
GO
~~ERROR (Code: 33557097)~~

~~ERROR (Message: Create view on stmt with PIVOT operator is not currently supported.)~~


-- WITH CTE stmt with usage of pivot operator is not currently supported
WITH
EmployeeData AS
(
    SELECT TOP 5 EmployeeID, [2] AS STORE2, [3] AS STORE3, [4] AS STORE4, [5] AS STORE5, [6] AS STORE6
    FROM
    (
        SELECT EmployeeID, ItemID, StoreID
        FROM StoreReceipt
    )AS srctable
    PIVOT (
        COUNT (ItemID)
        FOR StoreID IN ([2], [3], [4], [5], [6])
    ) AS pvt
)
SELECT *
FROM EmployeeData;
GO
~~ERROR (Code: 33557097)~~

~~ERROR (Message: WITH CTE stmt with usage of PIVOT operator is not currently supported)~~


-- Join stmts inside PIVOT statment (BABEL-4558)
SELECT *
FROM (SELECT OSTable.Oid, STable.Scode, STable.Type
        FROM OSTable
        INNER JOIN STable
        ON OSTable.Sid = STable.Id
        ) AS SourceTable
PIVOT ( MAX(Scode) FOR [Type] IN ([1], [2], [3]))
        AS os_pivot
GO
~~START~~
int#!#varchar#!#varchar#!#varchar
1#!#<NULL>#!#<NULL>#!#<NULL>
2#!#<NULL>#!#<NULL>#!#<NULL>
3#!#<NULL>#!#<NULL>#!#<NULL>
4#!#<NULL>#!#<NULL>#!#<NULL>
5#!#<NULL>#!#luctus#!#<NULL>
6#!#<NULL>#!#<NULL>#!#<NULL>
7#!#<NULL>#!#<NULL>#!#<NULL>
8#!#<NULL>#!#<NULL>#!#<NULL>
9#!#<NULL>#!#<NULL>#!#<NULL>
10#!#<NULL>#!#<NULL>#!#<NULL>
~~END~~


-- view usage in PIVOT data source
SELECT TOP 5 EmployeeID, [2] AS STORE2, [3] AS STORE3, [4] AS STORE4, [5] AS STORE5, [6] AS STORE6
FROM
(
    SELECT EmployeeID, ItemID, StoreID
    FROM StoreReceipt_view
)AS srctable
PIVOT (
    COUNT (ItemID)
    FOR StoreID IN ([2], [3], [4], [5], [6])
) AS pvt
GO
~~START~~
int#!#int#!#int#!#int#!#int#!#int
200#!#0#!#0#!#2#!#0#!#0
201#!#0#!#0#!#0#!#0#!#0
202#!#1#!#0#!#0#!#0#!#0
203#!#0#!#0#!#0#!#1#!#0
204#!#0#!#1#!#0#!#0#!#1
~~END~~


-- aggregate string value, when no row is selected, should output NULL
SELECT [seatings], [LEFT], [RIGHT] 
FROM
(
    SELECT [seatings], left_right 
    FROM seating_tbl
) AS p1
PIVOT (
    MAX(left_right) 
    FOR left_right IN ([LEFT], [RIGHT]) 
) AS p2
GO
~~START~~
varchar#!#varchar#!#varchar
SEAT1#!#LEFT#!#RIGHT
SEAT2#!#LEFT#!#<NULL>
SEAT3#!#LEFT#!#RIGHT
~~END~~

