-- tsql

use master;
go

create login key_column_usage_privilege_test_user with password='';
go

create database key_column_usage_privilege_test_db;
go

use key_column_usage_privilege_test_db;
go

create table key_column_usage_privilege_test_tb(arg1 int, arg2 int, primary key(arg1));
go

create user key_column_usage_privilege_test_user for login key_column_usage_privilege_test_user;
go

use master;
go

-- tsql user=key_column_usage_privilege_test_user password=''

use key_column_usage_privilege_test_db;
go

select * from information_schema.key_column_usage where table_name='key_column_usage_privilege_test_tb';
go
~~START~~
nvarchar#!#nvarchar#!#nvarchar#!#nvarchar#!#nvarchar#!#nvarchar#!#nvarchar#!#int#!#int
~~END~~


use master;
go

-- tsql

use key_column_usage_privilege_test_db;
go

grant select on key_column_usage_privilege_test_tb to key_column_usage_privilege_test_user;
go

use master;
go

-- tsql user=key_column_usage_privilege_test_user password=''

use key_column_usage_privilege_test_db;
go

select * from information_schema.key_column_usage where table_name='key_column_usage_privilege_test_tb';
go
~~START~~
nvarchar#!#nvarchar#!#nvarchar#!#nvarchar#!#nvarchar#!#nvarchar#!#nvarchar#!#int#!#int
key_column_usage_privilege_test_db#!#dbo#!#key_column_usage_privilege_test_tb_pkey#!#key_column_usage_privilege_test_db#!#dbo#!#key_column_usage_privilege_test_tb#!#arg1#!#1#!#<NULL>
~~END~~


use master;
go

-- tsql

use key_column_usage_privilege_test_db;
go

drop table key_column_usage_privilege_test_tb;
go

use master;
go

drop database key_column_usage_privilege_test_db;
go

-- psql

-- Need to terminate active session before cleaning up the login
SELECT pg_terminate_backend(pid) FROM pg_stat_get_activity(NULL)
WHERE sys.suser_name(usesysid) = 'key_column_usage_privilege_test_user' AND backend_type = 'client backend' AND usesysid IS NOT NULL;
GO
~~START~~
bool
t
~~END~~


-- Wait to sync with another session
SELECT pg_sleep(1);
GO
~~START~~
void

~~END~~


-- tsql
drop login key_column_usage_privilege_test_user;
go
