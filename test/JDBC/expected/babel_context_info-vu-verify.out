-- upgrade test
SELECT CONTEXT_INFO()
GO
~~START~~
varbinary
<NULL>
~~END~~


EXEC BABEL_GET_CONTEXT_INFO
GO
~~START~~
varbinary
<NULL>
~~END~~


SELECT * FROM BABEL_CONTEXT_INFO_VIEW
GO
~~START~~
varbinary
<NULL>
~~END~~


SELECT DISTINCT db_name(dbid), context_info FROM sys.sysprocesses WHERE spid = @@SPID
GO
~~START~~
nvarchar#!#varbinary
master#!#0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
~~END~~


SELECT context_info FROM sys.dm_exec_sessions WHERE session_id = @@SPID
GO
~~START~~
varbinary
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
~~END~~


EXEC BABEL_SET_CONTEXT_INFO 0x1234567812345678
GO

EXEC BABEL_GET_CONTEXT_INFO
GO
~~START~~
varbinary
1234567812345678000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
~~END~~


SELECT * FROM BABEL_CONTEXT_INFO_VIEW
GO
~~START~~
varbinary
1234567812345678000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
~~END~~


SELECT DISTINCT db_name(dbid), context_info FROM sys.sysprocesses WHERE spid = @@SPID
GO
~~START~~
nvarchar#!#varbinary
master#!#1234567812345678000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
~~END~~


SELECT context_info FROM sys.dm_exec_sessions WHERE session_id = @@SPID
GO
~~START~~
varbinary
1234567812345678000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
~~END~~



-- test all data type
-- set date/datetime/xml, which should not be supported
DECLARE @context date = '2006-01-02'
SET CONTEXT_INFO @context
GO
~~ERROR (Code: 33557097)~~

~~ERROR (Message: cannot cast type date to varbinary)~~


SELECT CONTEXT_INFO()
GO
~~START~~
varbinary
1234567812345678000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
~~END~~


DECLARE @context datetime = '2006-01-02 15:04:05'
SET CONTEXT_INFO @context
GO
~~ERROR (Code: 33557097)~~

~~ERROR (Message: cannot cast type datetime to varbinary)~~


SELECT CONTEXT_INFO()
GO
~~START~~
varbinary
1234567812345678000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
~~END~~


DECLARE @context xml = '<root name="hello"></root>'
SET CONTEXT_INFO @context
GO
~~ERROR (Code: 33557097)~~

~~ERROR (Message: cannot cast type xml to varbinary)~~


SELECT CONTEXT_INFO()
GO
~~START~~
varbinary
1234567812345678000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
~~END~~


-- set bit/decimal/numeric/money, which is supported in SQL Server but is not supported in Babelfish for now.
DECLARE @context bit = 1
SET CONTEXT_INFO @context
GO
~~ERROR (Code: 33557097)~~

~~ERROR (Message: cannot cast type "bit" to varbinary)~~


SELECT CONTEXT_INFO()
GO
~~START~~
varbinary
1234567812345678000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
~~END~~


DECLARE @context decimal(38, 6) = 12345678123456781234567812345678.123456
SET CONTEXT_INFO @context
GO
~~ERROR (Code: 33557097)~~

~~ERROR (Message: cannot cast type "decimal" to varbinary)~~


SELECT CONTEXT_INFO()
GO
~~START~~
varbinary
1234567812345678000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
~~END~~


DECLARE @context decimal(38, 6) = 12345678123456781234567812345678.123456
SET CONTEXT_INFO @context
GO
~~ERROR (Code: 33557097)~~

~~ERROR (Message: cannot cast type "decimal" to varbinary)~~


SELECT CONTEXT_INFO()
GO
~~START~~
varbinary
1234567812345678000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
~~END~~


DECLARE @context money = 12345678.12345678
SET CONTEXT_INFO @context
GO
~~ERROR (Code: 33557097)~~

~~ERROR (Message: cannot cast type money to varbinary)~~


SELECT CONTEXT_INFO()
GO
~~START~~
varbinary
1234567812345678000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
~~END~~


-- set char/varchar directly, which should not be supported.
SET CONTEXT_INFO abc
GO
~~ERROR (Code: 33557097)~~

~~ERROR (Message: SET CONTEXT_INFO option requires varbinary (128) NOT NULL parameter.)~~


SELECT CONTEXT_INFO()
GO
~~START~~
varbinary
1234567812345678000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
~~END~~


-- NB: set char/varchar by declared parameter, which is not supported in SQL Server but is supported in Babelfish.
DECLARE @context varchar(10) = 'abc'
SET CONTEXT_INFO @context
GO

SELECT CONTEXT_INFO()
GO
~~START~~
varbinary
6162630000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
~~END~~


-- set int/bigint/smallint/tinyint
DECLARE @context int = 2147483647
SET CONTEXT_INFO @context
GO

SELECT CONTEXT_INFO()
GO
~~START~~
varbinary
7FFFFFFF00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
~~END~~


DECLARE @context bigint = -9223372036854775808
SET CONTEXT_INFO @context
GO

SELECT CONTEXT_INFO()
GO
~~START~~
varbinary
8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
~~END~~


DECLARE @context smallint = -32768
SET CONTEXT_INFO @context
GO

SELECT CONTEXT_INFO()
GO
~~START~~
varbinary
8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
~~END~~


-- NB: set tinyint, which is ff0000000000000000 in SQL Server but is 00ff00000000000000 in Babelfish.
DECLARE @context tinyint = 255
SET CONTEXT_INFO @context
GO

SELECT CONTEXT_INFO()
GO
~~START~~
varbinary
00FF000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
~~END~~


-- set float/real
DECLARE @context float(53) = 12345678123456781234567812345678.123456
SET CONTEXT_INFO @context
GO

SELECT CONTEXT_INFO()
GO
~~START~~
varbinary
46637A6132F61DC6000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
~~END~~


DECLARE @context real = 12345678123456781234567812345678.123456
SET CONTEXT_INFO @context
GO

SELECT CONTEXT_INFO()
GO
~~START~~
varbinary
731BD30A00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
~~END~~


-- set 0
SET CONTEXT_INFO 0
go

SELECT CONTEXT_INFO()
GO
~~START~~
varbinary
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
~~END~~


-- set NULL
SET CONTEXT_INFO NULL
GO
~~ERROR (Code: 33557097)~~

~~ERROR (Message: SET CONTEXT_INFO option requires varbinary (128) NOT NULL parameter.)~~


SELECT CONTEXT_INFO()
GO
~~START~~
varbinary
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
~~END~~


-- set more than 128-byte hex constant
SET CONTEXT_INFO 0x123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567890
GO
~~ERROR (Code: 33557097)~~

~~ERROR (Message: SET CONTEXT_INFO option requires varbinary (128) NOT NULL parameter.)~~


SELECT CONTEXT_INFO()
GO
~~START~~
varbinary
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
~~END~~


-- set 128-byte hex constant
SET CONTEXT_INFO 0x1234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678
GO

SELECT CONTEXT_INFO()
GO
~~START~~
varbinary
1234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678
~~END~~


SELECT DISTINCT db_name(dbid), context_info FROM sys.sysprocesses WHERE spid = @@SPID
GO
~~START~~
nvarchar#!#varbinary
master#!#1234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678
~~END~~


SELECT context_info FROM sys.dm_exec_sessions WHERE session_id = @@SPID
GO
~~START~~
varbinary
1234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678
~~END~~


